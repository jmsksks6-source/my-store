<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { --main: #2c3e50; --gold: #d4af37; --green: #27ae60; --red: #e74c3c; --bg: #f4f7f6; }
        body { font-family: sans-serif; margin: 0; background: var(--bg); text-align: center; }
        header { background: var(--main); color: white; padding: 25px; position: relative; }
        
        /* Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .tabs { display: flex; justify-content: center; background: #fff; padding: 10px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); overflow-x: auto; }
        .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; font-weight: bold; color: #555; white-space: nowrap; }
        .tab-btn.active { color: var(--gold); border-bottom: 3px solid var(--gold); }

        /* Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
        .product-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; padding: 15px; }
        .card { background: white; border-radius: 12px; padding: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; }
        .card img { width: 100%; border-radius: 8px; height: 160px; object-fit: cover; }
        .out-of-stock { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); background: rgba(231, 76, 60, 0.9); color: white; padding: 5px 15px; border-radius: 5px; font-weight: bold; z-index: 10; }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 300; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 400px; padding: 20px; border-radius: 15px; position: relative; }
        
        #cart-view, #admin-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 400; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        
        .cart-btn { position: fixed; bottom: 20px; right: 20px; background: var(--green); color: white; padding: 15px 25px; border-radius: 30px; cursor: pointer; z-index: 100; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        .btn-main { background: var(--gold); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-admin { background: #34495e; color: white; border: none; padding: 5px 10px; border-radius: 4px; margin-top: 5px; cursor: pointer; font-size: 0.8rem; }
        
        #toast { visibility: hidden; min-width: 200px; background-color: #333; color: #fff; text-align: center; border-radius: 8px; padding: 16px; position: fixed; z-index: 500; left: 50%; bottom: 30px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

<header>
    <button onclick="showHistory()" style="position:absolute; top:10px; left:10px; background:rgba(255,255,255,0.2); color:white; border:none; padding:8px 12px; border-radius:5px;">ğŸ“‹ Ø·Ù„Ø¨Ø§ØªÙŠ</button>
    <h1>Ù…ØªØ¬Ø± Ø§Ù„Ù†Ø®Ø¨Ø© ğŸ‡®ğŸ‡¶</h1>
</header>

<div class="tabs">
    <button class="tab-btn active" onclick="filterProducts('all', this)">Ø§Ù„ÙƒÙ„</button>
    <button class="tab-btn" onclick="filterProducts('Ø³Ø§Ø¹Ø§Øª', this)">Ø³Ø§Ø¹Ø§Øª</button>
    <button class="tab-btn" onclick="filterProducts('Ø³Ù…Ø§Ø¹Ø§Øª', this)">Ø³Ù…Ø§Ø¹Ø§Øª</button>
    <button class="tab-btn" onclick="filterProducts('Ù…Ù„Ø§Ø¨Ø³', this)">Ù…Ù„Ø§Ø¨Ø³</button>
</div>

<div class="product-list" id="productList">
    </div>

<div id="optionsModal" class="modal">
    <div class="modal-content">
        <h3 id="optTitle">Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</h3>
        <p>Ø§Ø®ØªØ± Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</p>
        <select id="optVariant">
            </select>
        <button class="btn-main" onclick="confirmAddToCart()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
        <button onclick="closeModal()" style="border:none; background:none; color:gray; margin-top:10px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div class="cart-btn" onclick="showCart()">ğŸ›’ Ø§Ù„Ø³Ù„Ø© (<span id="cartCount">0</span>)</div>

<div id="cart-view">
    <button onclick="hideCart()" style="width:100%; padding:10px; margin-bottom:15px; background:#eee; border:none; border-radius:8px;">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
    <h2>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
    <div id="cartItems"></div>
    <div style="margin: 15px 0; border: 1px dashed var(--gold); padding: 10px; border-radius: 8px;">
        <input type="text" id="coupon" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" style="margin:0; width:70%;">
        <button style="width:25%; padding:10px; border:none; border-radius:8px;">ØªØ·Ø¨ÙŠÙ‚</button>
    </div>
    <p>Ø£Ø¬ÙˆØ± Ø§Ù„ØªÙˆØµÙŠÙ„: <strong>5,000 Ø¯.Ø¹</strong></p>
    <h3 id="totalPrice">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: 0 Ø¯.Ø¹</h3>
    <hr>
    <select id="province">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
        <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option><option value="Ø§Ù„Ø¨ØµØ±Ø©">Ø§Ù„Ø¨ØµØ±Ø©</option><option value="Ù†ÙŠÙ†ÙˆÙ‰">Ù†ÙŠÙ†ÙˆÙ‰</option>
        <option value="Ø§Ù„Ø£Ù†Ø¨Ø§Ø±">Ø§Ù„Ø£Ù†Ø¨Ø§Ø±</option><option value="Ø§Ù„Ù†Ø¬Ù">Ø§Ù„Ù†Ø¬Ù</option><option value="ÙƒØ±Ø¨Ù„Ø§Ø¡">ÙƒØ±Ø¨Ù„Ø§Ø¡</option>
        <option value="Ø°ÙŠ Ù‚Ø§Ø±">Ø°ÙŠ Ù‚Ø§Ø±</option><option value="Ø¨Ø§Ø¨Ù„">Ø¨Ø§Ø¨Ù„</option><option value="Ù…ÙŠØ³Ø§Ù†">Ù…ÙŠØ³Ø§Ù†</option>
        <option value="Ø§Ù„Ù…Ø«Ù†Ù‰">Ø§Ù„Ù…Ø«Ù†Ù‰</option><option value="Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©">Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©</option><option value="ÙˆØ§Ø³Ø·">ÙˆØ§Ø³Ø·</option>
        <option value="Ø¯ÙŠØ§Ù„Ù‰">Ø¯ÙŠØ§Ù„Ù‰</option><option value="ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†">ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†</option><option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
        <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option><option value="Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©">Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option><option value="Ø¯Ù‡ÙˆÙƒ">Ø¯Ù‡ÙˆÙƒ</option>
    </select>
    <input type="text" id="area" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø©">
    <input type="text" id="custName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    <input type="tel" id="custPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <button class="btn-main" id="sendBtn" style="background:var(--green); font-size:1.2rem;" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="admin-view">
    <button onclick="document.getElementById('admin-view').style.display='none'">Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù„ÙˆØ­Ø©</button>
    <h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
    <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
    <input type="number" id="pPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø¯ÙŠÙ†Ø§Ø±)">
    <input type="text" id="pImg" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
    <select id="pCat">
        <option value="Ø³Ø§Ø¹Ø§Øª">Ø³Ø§Ø¹Ø§Øª</option><option value="Ø³Ù…Ø§Ø¹Ø§Øª">Ø³Ù…Ø§Ø¹Ø§Øª</option><option value="Ù…Ù„Ø§Ø¨Ø³">Ù…Ù„Ø§Ø¨Ø³</option>
    </select>
    <button class="btn-main" onclick="adminAddProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
    <hr>
    <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
    <div id="adminList"></div>
</div>

<footer style="padding: 40px 10px; color: #bbb; font-size: 0.8rem;">
    <span onclick="openAdmin()" style="cursor:pointer;">&copy; 2026 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</span>
</footer>

<div id="toast">ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©!</div>

<script>
    emailjs.init("YXDPYRNxazZ45eYWS");

    let products = JSON.parse(localStorage.getItem('shop_products')) || [
        {id: 1, name: "Ø³Ø§Ø¹Ø© Ultra G9", price: 25000, img: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400", cat: "Ø³Ø§Ø¹Ø§Øª", stock: true},
        {id: 2, name: "Ø³Ù…Ø§Ø¹Ø© M10", price: 15000, img: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400", cat: "Ø³Ù…Ø§Ø¹Ø§Øª", stock: true}
    ];
    let cart = [];
    let selectedForCart = null;

    function renderProducts() {
        const list = document.getElementById('productList');
        const adminList = document.getElementById('adminList');
        list.innerHTML = ''; adminList.innerHTML = '';
        
        products.forEach(p => {
            // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø²Ø¨ÙˆÙ†
            list.innerHTML += `
                <div class="card" data-cat="${p.cat}">
                    ${!p.stock ? '<div class="out-of-stock">Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©</div>' : ''}
                    <img src="${p.img}">
                    <h3>${p.name}</h3>
                    <p style="color:var(--red); font-weight:bold;">${p.price.toLocaleString()} Ø¯.Ø¹</p>
                    <button class="btn-main" onclick="openOptions(${p.id})" ${!p.stock ? 'disabled style="background:#ccc"' : ''}>ğŸ›’ Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
                </div>
            `;
            // ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ§Ø¬Ø±
            adminList.innerHTML += `
                <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee;">
                    <span>${p.name}</span>
                    <div>
                        <button class="btn-admin" onclick="toggleStock(${p.id})">${p.stock ? 'Ù…ØªÙˆÙØ±' : 'Ù†ÙØ§Ø°'}</button>
                        <button class="btn-admin" style="background:var(--red)" onclick="deleteProduct(${p.id})">Ø­Ø°Ù</button>
                    </div>
                </div>
            `;
        });
    }

    function openOptions(id) {
        selectedForCart = products.find(p => p.id === id);
        document.getElementById('optTitle').innerText = selectedForCart.name;
        const select = document.getElementById('optVariant');
        select.innerHTML = '';
        
        if(selectedForCart.cat === 'Ù…Ù„Ø§Ø¨Ø³') {
            ['M', 'L', 'XL', 'XXL'].forEach(v => select.innerHTML += `<option value="${v}">${v}</option>`);
        } else {
            ['Ø£Ø³ÙˆØ¯', 'Ø£Ø¨ÙŠØ¶', 'ÙØ¶ÙŠ'].forEach(v => select.innerHTML += `<option value="${v}">${v}</option>`);
        }
        document.getElementById('optionsModal').style.display = 'flex';
    }

    function confirmAddToCart() {
        const variant = document.getElementById('optVariant').value;
        cart.push({...selectedForCart, variant});
        document.getElementById('cartCount').innerText = cart.length;
        closeModal();
        showToast();
    }

    function showCart() {
        document.getElementById('cart-view').style.display = 'block';
        let html = ''; let total = 0;
        cart.forEach((item, idx) => {
            html += `<p style="text-align:right;">${item.name} (${item.variant}) - ${item.price.toLocaleString()} Ø¯.Ø¹ <span onclick="removeItem(${idx})" style="color:red; cursor:pointer;">[Ø­Ø°Ù]</span></p>`;
            total += item.price;
        });
        document.getElementById('cartItems').innerHTML = html;
        document.getElementById('totalPrice').innerText = "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: " + (total + 5000).toLocaleString() + " Ø¯.Ø¹";
    }

    function sendOrder() {
        const prov = document.getElementById('province').value;
        const name = document.getElementById('custName').value;
        const phone = document.getElementById('custPhone').value;
        if(!prov || !name || !phone || cart.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const btn = document.getElementById('sendBtn');
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„..."; btn.disabled = true;

        const details = cart.map(i => `${i.name} (${i.variant})`).join(", ");
        const params = {
            to_name: "Ø§Ù„ØªØ§Ø¬Ø±", from_name: name, phone: phone,
            address: `Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${prov} | Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${document.getElementById('area').value}`,
            message: `Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${details} | ${document.getElementById('totalPrice').innerText}`
        };

        emailjs.send('service_ga7ytjo', 'template_lgvpsns', params).then(() => {
            alert("ØªÙ… Ø§Ù„Ø·Ù„Ø¨! Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.");
            cart = []; location.reload();
        });
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ§Ø¬Ø±
    function openAdmin() {
        if(prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:") === '1234') {
            document.getElementById('admin-view').style.display = 'block';
        }
    }

    function adminAddProduct() {
        const n = document.getElementById('pName').value;
        const p = document.getElementById('pPrice').value;
        const i = document.getElementById('pImg').value;
        const c = document.getElementById('pCat').value;
        if(!n || !p) return;
        products.push({id: Date.now(), name: n, price: parseInt(p), img: i || 'https://via.placeholder.com/150', cat: c, stock: true});
        localStorage.setItem('shop_products', JSON.stringify(products));
        renderProducts();
    }

    function toggleStock(id) {
        products = products.map(p => p.id === id ? {...p, stock: !p.stock} : p);
        localStorage.setItem('shop_products', JSON.stringify(products));
        renderProducts();
    }

    function deleteProduct(id) {
        products = products.filter(p => p.id !== id);
        localStorage.setItem('shop_products', JSON.stringify(products));
        renderProducts();
    }

    function showToast() {
        const x = document.getElementById("toast");
        x.className = "show";
        setTimeout(() => x.className = x.className.replace("show", ""), 3000);
    }
    
    function closeModal() { document.getElementById('optionsModal').style.display = 'none'; }
    function hideCart() { document.getElementById('cart-view').style.display = 'none'; }
    function filterProducts(c, b) {
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        b.classList.add('active');
        document.querySelectorAll('.card').forEach(card => card.style.display = (c === 'all' || card.dataset.cat === c) ? 'block' : 'none');
    }

    renderProducts();
</script>
</body>
</html>
