<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Elite Ultimate v5 | النسخة العبقرية</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --gold: #d4af37; --dark: #0f0f0f; --gray: #f4f4f4; --white: #ffffff; --success: #27ae60; }
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; transition: 0.2s; }
        body { margin: 0; background: var(--gray); color: #333; overflow-x: hidden; }

        /* نظام التنبيهات الذكي */
        .promo-banner { background: var(--dark); color: var(--gold); text-align: center; padding: 5px; font-size: 12px; font-weight: bold; border-bottom: 1px solid var(--gold); }
        
        header { background: var(--white); padding: 15px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .logo { font-size: 22px; font-weight: 900; letter-spacing: 1px; color: var(--dark); }
        .logo span { color: var(--gold); }

        /* شريط البحث الذكي */
        .search-container { padding: 10px 15px; background: var(--white); }
        .search-bar { position: relative; }
        .search-bar input { width: 100%; padding: 12px 40px 12px 15px; border-radius: 12px; border: 1px solid #ddd; background: #f9f9f9; outline: none; }
        .search-bar i { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #888; }

        /* التصنيفات السريعة */
        .cat-scroll { display: flex; overflow-x: auto; gap: 10px; padding: 10px 15px; scrollbar-width: none; }
        .cat-chip { background: var(--white); padding: 8px 20px; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; white-space: nowrap; border: 1px solid #ddd; }
        .cat-chip.active { background: var(--dark); color: var(--gold); border-color: var(--dark); }

        /* شبكة المنتجات الاحترافية */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 12px; }
        .product-card { background: var(--white); border-radius: 15px; overflow: hidden; position: relative; border: 1px solid #eee; }
        .product-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .product-card img { width: 100%; height: 180px; object-fit: cover; }
        .product-card .details { padding: 10px; }
        .product-card .p-name { font-size: 14px; font-weight: 700; height: 40px; overflow: hidden; }
        .product-card .p-price { color: #000; font-weight: 900; font-size: 16px; margin: 5px 0; }
        .product-card .p-price strike { color: #999; font-size: 12px; margin-right: 5px; }
        .viewer-count { font-size: 10px; color: var(--success); display: flex; align-items: center; gap: 4px; }

        /* السلة العائمة */
        .cart-float { position: fixed; bottom: 20px; left: 20px; background: var(--dark); color: var(--gold); padding: 15px 25px; border-radius: 30px; display: flex; gap: 10px; align-items: center; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 2000; cursor: pointer; }

        /* المودالات والـ Sheets */
        .sheet-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 3000; backdrop-filter: blur(5px); justify-content: center; align-items: flex-end; }
        .sheet-content { background: var(--white); width: 100%; max-width: 500px; border-radius: 25px 25px 0 0; padding: 20px; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        input, select, textarea { width: 100%; padding: 15px; margin: 8px 0; border: 1.5px solid #eee; border-radius: 12px; background: #fbfbfb; font-size: 16px; }
        input:focus { border-color: var(--gold); background: #fff; outline: none; }
        .btn-action { width: 100%; padding: 15px; border-radius: 12px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; background: var(--dark); color: var(--white); }
        .btn-action:disabled { opacity: 0.5; cursor: not-allowed; }

        /* سجل الطلبات */
        .order-ticket { border-right: 4px solid var(--gold); background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="promo-banner">توصيل مجاني لكافة محافظات العراق للطلبات فوق 150,000 د.ع</div>

<header>
    <div class="logo">ELITE<span>STORE</span></div>
    <div style="display: flex; gap: 15px; font-size: 20px;">
        <i class="fa-solid fa-clock-rotate-left" onclick="showHistory()" title="الطلبات"></i>
        <i class="fa-solid fa-user-gear" onclick="adminAccess()"></i>
    </div>
</header>

<div class="search-container">
    <div class="search-bar">
        <input type="text" id="smartSearch" placeholder="ابحث عن موديل، لون، أو سعر..." oninput="executeSearch()">
        <i class="fa-solid fa-magnifying-glass"></i>
    </div>
</div>

<div class="cat-scroll" id="catBar"></div>

<div class="grid" id="mainGrid"></div>

<div class="cart-float" onclick="openCart()">
    <i class="fa-solid fa-bag-shopping"></i>
    <span id="cartTotal">0 د.ع</span>
    <span id="cartQty" style="background:var(--gold); color:black; font-size:10px; padding:2px 6px; border-radius:50%; font-weight:bold;">0</span>
</div>

<div id="cartSheet" class="sheet-overlay">
    <div class="sheet-content" id="cartBody"></div>
</div>

<div id="shipSheet" class="sheet-overlay">
    <div class="sheet-content">
        <h3 style="margin-top:0"><i class="fa-solid fa-truck-fast"></i> إتمام الشراء</h3>
        <p style="font-size:13px; color:#666;">يرجى تزويدنا بمعلومات دقيقة لضمان وصول الطلب.</p>
        <input type="text" id="sh-name" placeholder="الاسم الكامل">
        <input type="tel" id="sh-phone" placeholder="رقم الهاتف (07xxxxxxxxx)" maxlength="11">
        <select id="sh-city">
            <option value="">اختر المحافظة...</option>
            <option>بغداد</option><option>البصرة</option><option>نينوى</option><option>أربيل</option><option>النجف</option>
            <option>كربلاء</option><option>ذي قار</option><option>كركوك</option><option>الأنبار</option><option>بابل</option>
            <option>ديالى</option><option>ميسان</option><option>الديوانية</option><option>صلاح الدين</option><option>دهوك</option>
            <option>السليمانية</option><option>واسط</option><option>المثنى</option>
        </select>
        <input type="text" id="sh-address" placeholder="العنوان بالتفصيل">
        <div id="priceSummary" style="background:#f9f9f9; padding:15px; border-radius:10px; margin:15px 0;"></div>
        <button class="btn-action" id="finalOrderBtn" onclick="sendOrderToServer()">تأكيد الطلب نهائياً</button>
        <button onclick="closeModals()" style="width:100%; background:none; border:none; margin-top:10px; color:#888; cursor:pointer;">تراجع</button>
    </div>
</div>

<script>
    emailjs.init("YXDPYRNxazZ45eYWS");

    // محرك البيانات الذكي
    let app = {
        products: JSON.parse(localStorage.getItem('e_p')) || [
            {id:1, n:"ساعة رولكس ديت جست", p:145000, op:180000, c:"ساعات", i:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=400"},
            {id:2, n:"عطر سوفاج ديور 100مل", p:95000, op:120000, c:"عطور", i:"https://images.unsplash.com/photo-1544467316-145c28d46924?w=400"},
            {id:3, n:"حذاء ييزي 350 بريميوم", p:75000, op:95000, c:"أحذية", i:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400"},
            {id:4, n:"نظارات ريبان فخمة", p:40000, op:55000, c:"إكسسوارات", i:"https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400"}
        ],
        cart: JSON.parse(localStorage.getItem('e_c')) || [],
        orders: JSON.parse(localStorage.getItem('e_o')) || []
    };

    function startEngine() {
        renderCategories();
        renderProducts(app.products);
        updateCartStats();
        autoFillUser();
    }

    function renderCategories() {
        const cats = ["الكل", ...new Set(app.products.map(p => p.c))];
        document.getElementById('catBar').innerHTML = cats.map(c => 
            `<div class="cat-chip ${c==='الكل'?'active':''}" onclick="filterCat('${c}', event)">${c}</div>`
        ).join('');
    }

    function renderProducts(data) {
        const grid = document.getElementById('mainGrid');
        grid.innerHTML = data.map(p => `
            <div class="product-card">
                <img src="${p.i}" loading="lazy">
                <div class="details">
                    <div class="viewer-count"><i class="fa-solid fa-eye"></i> يشاهد الآن ${Math.floor(Math.random()*8)+2}</div>
                    <div class="p-name">${p.n}</div>
                    <div class="p-price">${p.p.toLocaleString()} د.ع <strike>${p.op.toLocaleString()}</strike></div>
                    <button class="btn-action" style="padding:10px; font-size:12px;" onclick="addToCart(${p.id})">أضف للسلة</button>
                </div>
            </div>`).join('');
    }

    function executeSearch() {
        const q = document.getElementById('smartSearch').value.toLowerCase();
        const res = app.products.filter(p => p.n.toLowerCase().includes(q) || p.c.toLowerCase().includes(q));
        renderProducts(res);
    }

    function filterCat(c, e) {
        document.querySelectorAll('.cat-chip').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        renderProducts(c === "الكل" ? app.products : app.products.filter(p => p.c === c));
    }

    function addToCart(id) {
        const p = app.products.find(x => x.id === id);
        const exists = app.cart.find(x => x.id === id);
        if(exists) exists.qty++; else app.cart.push({...p, qty:1, cid: Date.now()});
        save(); updateCartStats();
        showFeedback("تمت الإضافة بنجاح ✅");
    }

    function updateCartStats() {
        const total = app.cart.reduce((s, i) => s + (i.p * i.qty), 0);
        document.getElementById('cartTotal').innerText = total.toLocaleString() + " د.ع";
        document.getElementById('cartQty').innerText = app.cart.reduce((s,i) => s + i.qty, 0);
    }

    function openCart() {
        if(app.cart.length === 0) return alert("السلة فارغة");
        const body = document.getElementById('cartBody');
        const total = app.cart.reduce((s, i) => s + (i.p * i.qty), 0);
        body.innerHTML = `
            <h3><i class="fa-solid fa-shopping-bag"></i> سلة المشتريات</h3>
            ${app.cart.map(i => `
                <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                    <img src="${i.i}" style="width:50px; height:50px; border-radius:8px;">
                    <div style="flex:1"><b>${i.n}</b><br><small>${i.p.toLocaleString()} د.ع</small></div>
                    <div style="display:flex; align-items:center; gap:8px;">
                        <i class="fa-solid fa-circle-minus" onclick="changeQty(${i.cid},-1)"></i>
                        <span>${i.qty}</span>
                        <i class="fa-solid fa-circle-plus" onclick="changeQty(${i.cid},1)"></i>
                    </div>
                </div>`).join('')}
            <button class="btn-action" style="background:var(--gold); color:black; margin-top:20px;" onclick="openShipping()">متابعة الدفع</button>
            <button onclick="closeModals()" style="width:100%; background:none; border:none; margin-top:10px;">إغلاق</button>`;
        document.getElementById('cartSheet').style.display = 'flex';
    }

    function changeQty(cid, v) {
        const i = app.cart.find(x => x.cid === cid);
        i.qty += v;
        if(i.qty < 1) app.cart = app.cart.filter(x => x.cid !== cid);
        save(); updateCartStats(); openCart();
        if(app.cart.length === 0) closeModals();
    }

    function openShipping() {
        document.getElementById('cartSheet').style.display = 'none';
        const ship = document.getElementById('shipSheet');
        ship.style.display = 'flex';
        
        const sub = app.cart.reduce((s, i) => s + (i.p * i.qty), 0);
        const deliv = sub >= 150000 ? 0 : 5000;
        document.getElementById('priceSummary').innerHTML = `
            <div style="display:flex; justify-content:space-between;"><span>المشتريات:</span><span>${sub.toLocaleString()} د.ع</span></div>
            <div style="display:flex; justify-content:space-between;"><span>التوصيل:</span><span>${deliv === 0 ? 'مجاني' : deliv.toLocaleString() + ' د.ع'}</span></div>
            <hr>
            <div style="display:flex; justify-content:space-between; font-weight:bold;"><span>الإجمالي:</span><span>${(sub+deliv).toLocaleString()} د.ع</span></div>
        `;
    }

    function sendOrderToServer() {
        const n = document.getElementById('sh-name').value;
        const p = document.getElementById('sh-phone').value;
        const c = document.getElementById('sh-city').value;
        const a = document.getElementById('sh-address').value;

        if(!n || p.length < 11 || !c) return alert("يرجى ملئ البيانات بشكل صحيح.");

        // حفظ بيانات المستخدم للطلبات القادمة
        localStorage.setItem('elite_user_info', JSON.stringify({n, p, c, a}));

        const btn = document.getElementById('finalOrderBtn');
        btn.disabled = true; btn.innerText = "جاري التأمين...";

        const total = app.cart.reduce((s, i) => s + (i.p * i.qty), 0) + (app.cart.reduce((s, i) => s + (i.p * i.qty), 0) >= 150000 ? 0 : 5000);
        const msg = app.cart.map(i => `${i.n} (x${i.qty})`).join(' , ');

        emailjs.send("service_ga7ytjo", "template_lgvpsns", {
            from_name: n, phone: p, address: `${c} - ${a}`,
            message: `الطلبات: ${msg} | الإجمالي: ${total.toLocaleString()} د.ع`,
            title: "طلب جديد"
        }).then(() => {
            alert("✅ تم إرسال طلبك! شكراً لثقتك بنا.");
            app.orders.push({id: Date.now(), total, date: new Date().toLocaleDateString()});
            app.cart = []; save(); location.reload();
        }, () => { alert("خطأ!"); btn.disabled = false; });
    }

    function showHistory() {
        const body = document.getElementById('cartBody');
        body.innerHTML = `<h3><i class="fa-solid fa-history"></i> سجل طلباتك</h3>
            ${app.orders.reverse().map(o => `
                <div class="order-ticket">
                    <b>طلب #${o.id.toString().slice(-4)}</b><br>
                    <small>التاريخ: ${o.date}</small> | <b>${o.total.toLocaleString()} د.ع</b>
                </div>`).join('') || "لا يوجد طلبات سابقة"}`;
        document.getElementById('cartSheet').style.display = 'flex';
    }

    function autoFillUser() {
        const saved = JSON.parse(localStorage.getItem('elite_user_info'));
        if(saved) {
            document.getElementById('sh-name').value = saved.n;
            document.getElementById('sh-phone').value = saved.p;
            document.getElementById('sh-city').value = saved.c;
            document.getElementById('sh-address').value = saved.a;
        }
    }

    function showFeedback(txt) {
        const f = document.createElement('div');
        f.style = "position:fixed; top:20px; left:50%; transform:translateX(-50%); background:var(--dark); color:var(--gold); padding:10px 20px; border-radius:10px; z-index:5000; font-weight:bold;";
        f.innerText = txt;
        document.body.appendChild(f);
        setTimeout(() => f.remove(), 2000);
    }

    function save() {
        localStorage.setItem('e_p', JSON.stringify(app.products));
        localStorage.setItem('e_c', JSON.stringify(app.cart));
        localStorage.setItem('e_o', JSON.stringify(app.orders));
    }

    function closeModals() { document.querySelectorAll('.sheet-overlay').forEach(o => o.style.display = 'none'); }

    window.onload = startEngine;
</script>
</body>
</html>
