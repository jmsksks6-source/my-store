<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„Ù…Ø·ÙˆØ±</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { --main: #2c3e50; --gold: #d4af37; --green: #27ae60; --red: #e74c3c; }
        body { font-family: sans-serif; margin: 0; background: #f4f7f6; text-align: center; }
        header { background: var(--main); color: white; padding: 25px; position: relative; }
        .tabs { display: flex; justify-content: center; background: #fff; padding: 10px; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; font-weight: bold; color: #555; }
        .tab-btn.active { color: var(--gold); border-bottom: 3px solid var(--gold); }
        .product-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; padding: 20px; }
        .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .card img { width: 100%; border-radius: 10px; height: 180px; object-fit: cover; }
        #cart-view, #history-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 200; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .cart-btn { position: fixed; bottom: 20px; right: 20px; background: var(--green); color: white; padding: 15px 25px; border-radius: 30px; cursor: pointer; z-index: 100; font-weight: bold; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .confirm-btn { background: var(--green); color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; font-size: 1.1rem; cursor: pointer; font-weight: bold; }
        .history-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 10px; text-align: right; background: #f9f9f9; }
    </style>
</head>
<body>

<header>
    <button onclick="showHistory()" style="position:absolute; top:10px; left:10px; background:#34495e; color:white; border:none; padding:8px 12px; border-radius:5px; cursor:pointer;">ğŸ“‹ Ø·Ù„Ø¨Ø§ØªÙŠ</button>
    <h1>Ù…ØªØ¬Ø± Ø§Ù„Ù†Ø®Ø¨Ø© ğŸ‡®ğŸ‡¶</h1>
</header>

<div class="tabs">
    <button class="tab-btn active" onclick="filterProducts('all', this)">Ø§Ù„ÙƒÙ„</button>
    <button class="tab-btn" onclick="filterProducts('watch', this)">Ø³Ø§Ø¹Ø§Øª</button>
    <button class="tab-btn" onclick="filterProducts('audio', this)">Ø³Ù…Ø§Ø¹Ø§Øª</button>
    <button class="tab-btn" onclick="filterProducts('clothes', this)">Ù…Ù„Ø§Ø¨Ø³</button>
</div>

<div class="product-list" id="products">
    <div class="card" data-cat="watch">
        <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400">
        <h3>Ø³Ø§Ø¹Ø© Ultra G9</h3>
        <p style="color:red; font-weight:bold;">25,000 Ø¯ÙŠÙ†Ø§Ø±</p>
        <button onclick="addToCart('Ø³Ø§Ø¹Ø© Ultra G9', 25000)" style="background:var(--gold); border:none; padding:10px; width:100%; border-radius:8px; cursor:pointer;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
    </div>
    <div class="card" data-cat="audio">
        <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400">
        <h3>Ø³Ù…Ø§Ø¹Ø© M10 Ø§Ù„Ø£ØµÙ„ÙŠØ©</h3>
        <p style="color:red; font-weight:bold;">15,000 Ø¯ÙŠÙ†Ø§Ø±</p>
        <button onclick="addToCart('Ø³Ù…Ø§Ø¹Ø© M10', 15000)" style="background:var(--gold); border:none; padding:10px; width:100%; border-radius:8px; cursor:pointer;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
    </div>
    <div class="card" data-cat="clothes">
        <img src="https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400">
        <h3>ØªÙŠØ´ÙŠØ±Øª ØµÙŠÙÙŠ Ù‚Ø·Ù†</h3>
        <p style="color:red; font-weight:bold;">12,000 Ø¯ÙŠÙ†Ø§Ø±</p>
        <button onclick="addToCart('ØªÙŠØ´ÙŠØ±Øª Ù‚Ø·Ù†', 12000)" style="background:var(--gold); border:none; padding:10px; width:100%; border-radius:8px; cursor:pointer;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
    </div>
</div>

<div class="cart-btn" onclick="showCart()">ğŸ›’ Ø§Ù„Ø³Ù„Ø© (<span id="count">0</span>)</div>

<div id="cart-view">
    <button onclick="document.getElementById('cart-view').style.display='none'" style="width:100%; padding:10px; margin-bottom:20px; cursor:pointer;">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</button>
    <h2>Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
    <div id="items"></div>
    <hr>
    <p>Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: <span id="subtotal">0</span> Ø¯.Ø¹</p>
    <p>Ø£Ø¬ÙˆØ± Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª: <strong>5,000 Ø¯.Ø¹</strong></p>
    <h3 id="total">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: 0 Ø¯ÙŠÙ†Ø§Ø±</h3>
    <hr>
    <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
    <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
    <select id="province">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</option>
        <option value="Ø¨ØºØ¯Ø§Ø¯">Ø¨ØºØ¯Ø§Ø¯</option><option value="Ø§Ù„Ø¨ØµØ±Ø©">Ø§Ù„Ø¨ØµØ±Ø©</option><option value="Ù†ÙŠÙ†ÙˆÙ‰">Ù†ÙŠÙ†ÙˆÙ‰</option>
        <option value="Ø§Ù„Ø£Ù†Ø¨Ø§Ø±">Ø§Ù„Ø£Ù†Ø¨Ø§Ø±</option><option value="Ø§Ù„Ù†Ø¬Ù">Ø§Ù„Ù†Ø¬Ù</option><option value="ÙƒØ±Ø¨Ù„Ø§Ø¡">ÙƒØ±Ø¨Ù„Ø§Ø¡</option>
        <option value="Ø°ÙŠ Ù‚Ø§Ø±">Ø°ÙŠ Ù‚Ø§Ø±</option><option value="Ø¨Ø§Ø¨Ù„">Ø¨Ø§Ø¨Ù„</option><option value="Ù…ÙŠØ³Ø§Ù†">Ù…ÙŠØ³Ø§Ù†</option>
        <option value="Ø§Ù„Ù…Ø«Ù†Ù‰">Ø§Ù„Ù…Ø«Ù†Ù‰</option><option value="Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©">Ø§Ù„Ù‚Ø§Ø¯Ø³ÙŠØ©</option><option value="ÙˆØ§Ø³Ø·">ÙˆØ§Ø³Ø·</option>
        <option value="Ø¯ÙŠØ§Ù„Ù‰">Ø¯ÙŠØ§Ù„Ù‰</option><option value="ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†">ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†</option><option value="ÙƒØ±ÙƒÙˆÙƒ">ÙƒØ±ÙƒÙˆÙƒ</option>
        <option value="Ø£Ø±Ø¨ÙŠÙ„">Ø£Ø±Ø¨ÙŠÙ„</option><option value="Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©">Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option><option value="Ø¯Ù‡ÙˆÙƒ">Ø¯Ù‡ÙˆÙƒ</option>
    </select>
    <input type="text" id="area" placeholder="Ø§Ù„Ù…Ù†Ø·Ù‚Ø© / Ø§Ù„Ù‚Ø¶Ø§Ø¡">
    <input type="tel" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„">
    <button class="confirm-btn" id="sendBtn" onclick="sendOrder()">ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
</div>

<div id="history-view">
    <button onclick="document.getElementById('history-view').style.display='none'" style="width:100%; padding:10px; margin-bottom:20px; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚ X</button>
    <h2>ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
    <div id="history-list"></div>
</div>

<script>
    emailjs.init("YXDPYRNxazZ45eYWS");
    let cart = [];
    const shippingFee = 5000;

    function filterProducts(cat, btn) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.card').forEach(card => {
            card.style.display = (cat === 'all' || card.getAttribute('data-cat') === cat) ? 'block' : 'none';
        });
    }

    function addToCart(n, p) {
        cart.push({name: n, price: p});
        document.getElementById('count').innerText = cart.length;
        alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ…");
    }

    function showCart() {
        document.getElementById('cart-view').style.display = 'block';
        let itemsHtml = ''; let subtotal = 0;
        cart.forEach((item) => {
            itemsHtml += `<p style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:5px 0;">${item.name} <span>${item.price.toLocaleString()} Ø¯.Ø¹</span></p>`;
            subtotal += item.price;
        });
        document.getElementById('subtotal').innerText = subtotal.toLocaleString();
        document.getElementById('total').innerText = "Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ: " + (subtotal + shippingFee).toLocaleString() + " Ø¯ÙŠÙ†Ø§Ø±";
    }

    function sendOrder() {
        const prov = document.getElementById('province').value;
        const area = document.getElementById('area').value;
        const name = document.getElementById('name').value;
        const phone = document.getElementById('phone').value;
        const btn = document.getElementById('sendBtn');

        if(!prov || !name || !phone || cart.length === 0) { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹"); return; }
        
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„..."; btn.disabled = true;
        const orderID = Math.floor(1000 + Math.random() * 9000);
        const orderItems = cart.map(i => i.name).join(", ");
        const finalPrice = document.getElementById('total').innerText;

        const params = {
            to_name: "Ø§Ù„ØªØ§Ø¬Ø±", from_name: name, phone: phone,
            address: `Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©: ${prov} | Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: ${area}`,
            message: `Ø·Ù„Ø¨ Ø±Ù‚Ù… #${orderID} | Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${orderItems} | ${finalPrice}`
        };

        emailjs.send('service_ga7ytjo', 'template_lgvpsns', params).then(() => {
            let history = JSON.parse(localStorage.getItem('myOrders')) || [];
            history.push({ id: orderID, date: new Date().toLocaleDateString('ar-EG'), items: orderItems, price: finalPrice, customer: name });
            localStorage.setItem('myOrders', JSON.stringify(history));
            alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­! Ø³ØªØ¬Ø¯ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø³Ø¬Ù„ 'Ø·Ù„Ø¨Ø§ØªÙŠ'.");
            location.reload();
        }, () => { alert("ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"); btn.disabled = false; btn.innerText = "ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨"; });
    }

    function showHistory() {
        document.getElementById('history-view').style.display = 'block';
        let history = JSON.parse(localStorage.getItem('myOrders')) || [];
        let html = history.length === 0 ? '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</p>' : '';
        history.reverse().forEach(order => {
            html += `<div class="history-card">
                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> #${order.id}</p>
                <p><strong>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</strong> ${order.items}</p>
                <p><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</strong> ${order.price}</p>
                <p style="font-size:0.8rem; color:gray;">Ø§Ù„ØªØ§Ø±ÙŠØ®: ${order.date}</p>
                <button onclick="cancelOrder(${order.id}, '${order.customer}')" style="color:var(--red); border:none; background:none; cursor:pointer; text-decoration:underline; font-weight:bold;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ âŒ</button>
            </div>`;
        });
        document.getElementById('history-list').innerHTML = html;
    }

    function cancelOrder(id, customerName) {
        if(!confirm("Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡ Ù„Ù„Ø·Ù„Ø¨ #" + id + "ØŸ")) return;
        const params = { to_name: "Ø§Ù„ØªØ§Ø¬Ø±", from_name: customerName, phone: "Ø¥Ù„ØºØ§Ø¡", address: "Ù…Ù† Ø§Ù„Ø³Ø¬Ù„", message: `âš ï¸ Ø·Ù„Ø¨ Ø¥Ù„ØºØ§Ø¡ Ø¹Ø§Ø¬Ù„ Ø±Ù‚Ù… #${id}` };
        emailjs.send('service_ga7ytjo', 'template_lgvpsns', params).then(() => {
            let history = JSON.parse(localStorage.getItem('myOrders')) || [];
            history = history.filter(o => o.id !== id);
            localStorage.setItem('myOrders', JSON.stringify(history));
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ ÙˆØ­Ø°Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.");
            location.reload();
        });
    }
</script>
</body>
</html>
