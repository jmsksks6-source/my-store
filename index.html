<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>TITAN ENTERPRISE V10 | Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„ (Theming) */
        :root {
            --primary-dark: #0a0a0a;
            --accent-gold: #c5a059;
            --accent-gold-light: #e0c28d;
            --soft-white: #fcfcfc;
            --pure-white: #ffffff;
            --error-red: #ff4757;
            --success-green: #2ed573;
            --gray-100: #f1f2f6;
            --gray-200: #dfe4ea;
            --gray-500: #a4b0be;
            --card-shadow: 0 15px 35px rgba(0,0,0,0.05);
            --glass-bg: rgba(255, 255, 255, 0.95);
            --transition-smooth: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }

        /* 2. Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Base) */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        html { scroll-behavior: smooth; }
        body {
            margin: 0; font-family: 'Cairo', sans-serif; background: var(--gray-100);
            color: var(--primary-dark); overflow-x: hidden; line-height: 1.6;
        }

        /* 3. Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø§Ù… (Layout) */
        .app-container { min-height: 100vh; display: flex; flex-direction: column; }

        /* 4. Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„ÙØ§Ø®Ø± (Premium Header) */
        .main-header {
            background: var(--glass-bg); backdrop-filter: blur(20px);
            position: sticky; top: 0; z-index: 5000; border-bottom: 1px solid var(--gray-200);
            transition: var(--transition-smooth);
        }
        .header-top {
            background: var(--primary-dark); color: var(--accent-gold);
            text-align: center; padding: 6px; font-size: 11px; font-weight: 700;
            letter-spacing: 1px;
        }
        .header-main {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 5%; max-width: 1400px; margin: 0 auto;
        }
        .brand-logo { font-size: 24px; font-weight: 900; color: var(--primary-dark); cursor: pointer; }
        .brand-logo span { color: var(--accent-gold); }

        /* 5. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ (Smart Search) */
        .search-engine { position: relative; flex: 1; max-width: 600px; margin: 0 30px; }
        .search-input {
            width: 100%; padding: 12px 50px 12px 20px; border-radius: 50px;
            border: 2px solid var(--gray-200); background: var(--pure-white);
            font-size: 14px; transition: var(--transition-smooth);
        }
        .search-input:focus { border-color: var(--accent-gold); box-shadow: 0 0 15px rgba(197, 160, 89, 0.1); }
        .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: var(--gray-500); }

        /* 6. Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙ†Ù‚Ù„ (Navigation Tools) */
        .nav-tools { display: flex; gap: 20px; align-items: center; }
        .tool-icon { position: relative; cursor: pointer; font-size: 20px; transition: var(--transition-smooth); }
        .tool-icon:hover { color: var(--accent-gold); transform: translateY(-2px); }
        .count-badge {
            position: absolute; top: -8px; right: -10px; background: var(--accent-gold);
            color: var(--primary-dark); font-size: 10px; font-weight: 900;
            width: 18px; height: 18px; border-radius: 50%; display: flex;
            align-items: center; justify-content: center; border: 2px solid var(--pure-white);
        }

        /* 7. ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (Categories System) */
        .categories-nav {
            background: var(--pure-white); overflow-x: auto; display: flex;
            gap: 15px; padding: 15px 5%; border-bottom: 1px solid var(--gray-200);
            scrollbar-width: none;
        }
        .categories-nav::-webkit-scrollbar { display: none; }
        .cat-item {
            padding: 10px 25px; border-radius: 12px; background: var(--gray-100);
            white-space: nowrap; font-size: 14px; font-weight: 600; cursor: pointer;
            transition: var(--transition-smooth); border: 2px solid transparent;
        }
        .cat-item.active { background: var(--primary-dark); color: var(--accent-gold); border-color: var(--accent-gold); }

        /* 8. Ù†Ø¸Ø§Ù… Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª (The Grid) */
        .content-main { padding: 30px 5%; max-width: 1400px; margin: 0 auto; flex: 1; }
        .product-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 25px; animation: fadeInUp 0.8s ease;
        }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* 9. Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ù†ØªØ¬ (Product Node) */
        .product-card {
            background: var(--pure-white); border-radius: 20px; overflow: hidden;
            box-shadow: var(--card-shadow); border: 1px solid var(--gray-200);
            position: relative; display: flex; flex-direction: column;
        }
        .product-card:hover { transform: translateY(-10px); }
        .img-wrapper { position: relative; width: 100%; height: 260px; overflow: hidden; }
        .img-wrapper img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.6s ease; }
        .product-card:hover .img-wrapper img { transform: scale(1.1); }
        
        .promo-tag {
            position: absolute; top: 15px; right: 15px; background: var(--accent-gold);
            color: var(--primary-dark); padding: 4px 12px; border-radius: 8px;
            font-size: 11px; font-weight: 900; z-index: 5;
        }

        .card-details { padding: 18px; flex: 1; display: flex; flex-direction: column; }
        .p-category { font-size: 11px; color: var(--gray-500); font-weight: 700; text-transform: uppercase; }
        .p-name { font-size: 15px; font-weight: 700; margin: 8px 0; height: 45px; overflow: hidden; }
        .price-box { display: flex; align-items: center; gap: 10px; margin-top: auto; }
        .p-price { font-size: 19px; font-weight: 900; color: var(--primary-dark); }
        .p-old-price { font-size: 13px; text-decoration: line-through; color: var(--gray-500); }

        .add-to-cart-btn {
            width: 100%; padding: 14px; margin-top: 15px; border-radius: 12px;
            border: none; background: var(--primary-dark); color: var(--accent-gold);
            font-weight: 700; cursor: pointer; transition: var(--transition-smooth);
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .add-to-cart-btn:hover { background: #1a1a1a; letter-spacing: 1px; }

        /* 10. Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© (Cart Side Panel) */
        .cart-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px); z-index: 6000; display: none;
        }
        .cart-panel {
            position: fixed; left: -400px; top: 0; width: 400px; height: 100%;
            background: var(--pure-white); z-index: 6001; transition: 0.5s;
            display: flex; flex-direction: column; box-shadow: 10px 0 30px rgba(0,0,0,0.1);
        }
        .cart-panel.active { left: 0; }
        .cart-header { padding: 25px; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; }
        .cart-items-list { flex: 1; overflow-y: auto; padding: 20px; }
        .cart-footer { padding: 25px; border-top: 1px solid var(--gray-200); background: var(--soft-white); }

        /* 11. Ù†Ø¸Ø§Ù… Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Master Modals) */
        .master-modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            z-index: 7000; display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-inner {
            background: var(--pure-white); width: 100%; max-width: 550px;
            border-radius: 30px; padding: 40px; position: relative;
            max-height: 90vh; overflow-y: auto; animation: scaleUp 0.3s ease;
        }
        @keyframes scaleUp { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* 12. Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ (Form System) */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 700; margin-bottom: 8px; }
        .form-control {
            width: 100%; padding: 15px; border-radius: 12px; border: 2px solid var(--gray-200);
            background: var(--gray-100); font-family: inherit; font-size: 16px; transition: 0.3s;
        }
        .form-control:focus { border-color: var(--accent-gold); background: var(--pure-white); }

        /* 13. Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø±ÙŠØ© (Admin Hub) */
        #adminHub { display: none; padding: 40px 5%; background: var(--pure-white); min-height: 100vh; }
        .stat-card { background: var(--soft-white); padding: 20px; border-radius: 15px; border: 1px solid var(--gray-200); }

        /* 14. Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± (Invoice UI) */
        .invoice-box {
            padding: 30px; border: 2px dashed var(--accent-gold); border-radius: 20px;
            background: #fffcf5; margin-top: 25px;
        }

        /* 15. ÙÙˆØªØ± Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Footer) */
        footer { background: var(--primary-dark); color: var(--pure-white); padding: 60px 5% 20px; margin-top: 100px; }
        .footer-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 40px; border-bottom: 1px solid #333; padding-bottom: 40px;
        }
        .footer-title { color: var(--accent-gold); font-size: 18px; font-weight: 700; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="app-container">
    <header class="main-header">
        <div class="header-top">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¬Ø§Ø±Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ Ù„Ù„Ø´Ø±ÙƒØ§Øª - TITAN ENTERPRISE EDITION 2026</div>
        <div class="header-main">
            <div class="brand-logo" onclick="location.reload()">TITAN<span>STORE</span></div>
            
            <div class="search-engine">
                <i class="fa-solid fa-magnifying-glass search-icon"></i>
                <input type="text" class="search-input" id="globalSearch" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ØŒ Ø¹Ù„Ø§Ù…Ø© ØªØ¬Ø§Ø±ÙŠØ©ØŒ Ø£Ùˆ ØªØµÙ†ÙŠÙ..." oninput="Titan.Engine.Search()">
            </div>

            <div class="nav-tools">
                <div class="tool-icon" onclick="Titan.UI.ToggleAdmin()" title="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…">
                    <i class="fa-solid fa-user-tie"></i>
                </div>
                <div class="tool-icon" onclick="Titan.UI.ToggleCart()" title="Ø§Ù„Ø³Ù„Ø©">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span class="count-badge" id="cartBadge">0</span>
                </div>
            </div>
        </div>
        <div class="categories-nav" id="catWrapper"></div>
    </header>

    <main class="content-main" id="storefront">
        <div class="product-grid" id="mainGrid"></div>
    </main>

    <section id="adminHub">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h1><i class="fa-solid fa-chart-line"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h1>
            <button onclick="location.reload()" class="add-to-cart-btn" style="width:auto; padding:10px 25px;">Ø®Ø±ÙˆØ¬</button>
        </div>
        <hr>
        <div class="footer-grid">
            <div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3><p id="stat-products">0</p></div>
            <div class="stat-card"><h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3><p id="stat-orders">0</p></div>
            <div class="stat-card"><h3>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</h3><p id="stat-revenue">0 Ø¯.Ø¹</p></div>
        </div>
        <div style="margin-top:40px;">
            <h3>Ø£Ø¶Ù Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø®Ø²Ù†</h3>
            <div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:20px;">
                <input type="text" id="adm-name" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
                <input type="number" id="adm-price" class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¯.Ø¹">
                <input type="text" id="adm-img" class="form-control" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬">
                <select id="adm-cat" class="form-control">
                    <option>Ø³Ø§Ø¹Ø§Øª</option><option>Ø¹Ø·ÙˆØ±</option><option>Ø£Ø­Ø°ÙŠØ©</option><option>Ù…Ù„Ø§Ø¨Ø³</option><option>Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª</option>
                </select>
            </div>
            <button onclick="Titan.Engine.AddProduct()" class="add-to-cart-btn" style="margin-top:20px;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù† Ø§Ù„ÙÙˆØ±ÙŠ</button>
        </div>
        <div id="admin-orders-list" style="margin-top:40px;"></div>
    </section>

    <div class="cart-overlay" id="cartOverlay" onclick="Titan.UI.ToggleCart()"></div>
    <div class="cart-panel" id="cartPanel">
        <div class="cart-header">
            <h3>Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
            <i class="fa-solid fa-xmark" style="cursor:pointer; font-size:24px;" onclick="Titan.UI.ToggleCart()"></i>
        </div>
        <div class="cart-items-list" id="cartList"></div>
        <div class="cart-footer">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                <span id="cartTotalText" style="font-weight:900; font-size:20px;">0 Ø¯.Ø¹</span>
            </div>
            <button class="add-to-cart-btn" onclick="Titan.UI.OpenCheckout()">Ø¥ÙƒÙ…Ø§Ù„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡</button>
        </div>
    </div>

    <div id="masterModal" class="master-modal">
        <div class="modal-inner" id="modalTarget"></div>
    </div>

    <footer>
        <div class="footer-grid">
            <div>
                <div class="footer-title">TITAN STORE</div>
                <p>Ø£ÙƒØ¨Ø± Ù…Ù†ØµØ© ØªØ¬Ø§Ø±Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© ÙÙŠ Ø§Ù„Ø¹Ø±Ø§Ù‚ Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© Ø§Ù„ÙØ§Ø®Ø±Ø©.</p>
            </div>
            <div>
                <div class="footer-title">Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</div>
                <p>Ù…Ù† Ù†Ø­Ù†</p><p>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</p><p>Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</p>
            </div>
            <div>
                <div class="footer-title">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</div>
                <p><i class="fa-solid fa-phone"></i> +964 770 000 0000</p>
                <p><i class="fa-solid fa-envelope"></i> info@titan-store.com</p>
            </div>
        </div>
        <div style="text-align:center; padding-top:20px; font-size:12px; color:#888;">&copy; 2026 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø´Ø±ÙƒØ© TITAN ENTERPRISE</div>
    </footer>
</div>

<script>
/**
 * TITAN ENTERPRISE CORE ENGINE v10.0
 * Ø¨Ù†ÙŠØ© Ø¨Ø±Ù…Ø¬ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†ØŒ Ø§Ù„Ø³Ù„Ø©ØŒ ÙˆØ§Ù„ÙÙˆØªØ±Ø©
 */
const Titan = (() => {
    
    // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ (Central State)
    let state = {
        products: JSON.parse(localStorage.getItem('tit_prod')) || [
            {id: 1001, name: "Ø³Ø§Ø¹Ø© Ø±ÙˆÙ„ÙƒØ³ Ø¯Ø§ÙŠØªÙˆÙ†Ø§ Ø¨Ù„Ø§ØªÙŠÙ†ÙŠÙˆÙ…", price: 650000, oldPrice: 800000, cat: "Ø³Ø§Ø¹Ø§Øª", img: "https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=500", stock: 10},
            {id: 1002, name: "Ø¹Ø·Ø± ÙƒØ±ÙŠØ¯ Ø£ÙÙŠÙ†ØªÙˆØ³ Ù„ÙŠÙ…ÙŠØªØ¯", price: 320000, oldPrice: 400000, cat: "Ø¹Ø·ÙˆØ±", img: "https://images.unsplash.com/photo-1544467316-145c28d46924?w=500", stock: 5},
            {id: 1003, name: "Ø­Ø°Ø§Ø¡ Ù„ÙˆÙŠØ³ ÙÙŠØªÙˆÙ† Ø±Ø§Ù†Ø±", price: 185000, oldPrice: 250000, cat: "Ø£Ø­Ø°ÙŠØ©", img: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=500", stock: 12},
            {id: 1004, name: "Ù†Ø¸Ø§Ø±Ø© Ø´Ù…Ø³ÙŠØ© ÙƒØ§Ø±ØªÙŠÙŠÙ‡ ÙØ®Ù…Ø©", price: 95000, oldPrice: 130000, cat: "Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", img: "https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=500", stock: 20}
        ],
        cart: JSON.parse(localStorage.getItem('tit_cart')) || [],
        orders: JSON.parse(localStorage.getItem('tit_orders')) || [],
        activeCategory: "Ø§Ù„ÙƒÙ„",
        settings: { deliveryFee: 5000, freeDeliveryThreshold: 150000 }
    };

    // 2. Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Engine Logic)
    const Engine = {
        Init: () => {
            emailjs.init("YXDPYRNxazZ45eYWS");
            UI.RenderCategories();
            UI.RenderProducts();
            UI.UpdateStats();
            console.log("Titan System Active...");
        },

        Save: () => {
            localStorage.setItem('tit_prod', JSON.stringify(state.products));
            localStorage.setItem('tit_cart', JSON.stringify(state.cart));
            localStorage.setItem('tit_orders', JSON.stringify(state.orders));
        },

        Search: () => {
            const query = document.getElementById('globalSearch').value.toLowerCase();
            const filtered = state.products.filter(p => 
                p.name.toLowerCase().includes(query) || p.cat.toLowerCase().includes(query)
            );
            UI.RenderProducts(filtered);
        },

        AddProduct: () => {
            const n = document.getElementById('adm-name').value;
            const p = document.getElementById('adm-price').value;
            const i = document.getElementById('adm-img').value;
            const c = document.getElementById('adm-cat').value;

            if(!n || !p) return UI.Notify("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¦ ÙƒØ§ÙØ© Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬", "error");

            state.products.unshift({
                id: Date.now(), name: n, price: parseInt(p), 
                oldPrice: parseInt(p) + 10000, cat: c, 
                img: i || "https://via.placeholder.com/400", stock: 10
            });
            Engine.Save(); UI.RenderProducts(); UI.UpdateStats();
            UI.Notify("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø®Ø²Ù† âœ…");
        }
    };

    // 3. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (UI Layer)
    const UI = {
        RenderCategories: () => {
            const cats = ["Ø§Ù„ÙƒÙ„", "Ø³Ø§Ø¹Ø§Øª", "Ø¹Ø·ÙˆØ±", "Ø£Ø­Ø°ÙŠØ©", "Ù…Ù„Ø§Ø¨Ø³", "Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª"];
            document.getElementById('catWrapper').innerHTML = cats.map(c => `
                <div class="cat-item ${state.activeCategory === c ? 'active' : ''}" 
                     onclick="Titan.UI.SetCategory('${c}')">${c}</div>
            `).join('');
        },

        RenderProducts: (data = state.products) => {
            const grid = document.getElementById('mainGrid');
            const filtered = state.activeCategory === "Ø§Ù„ÙƒÙ„" ? data : data.filter(p => p.cat === state.activeCategory);
            
            grid.innerHTML = filtered.map(p => `
                <div class="product-card">
                    <div class="promo-tag">Ø®ØµÙ… Ù…Ø­Ø¯ÙˆØ¯</div>
                    <div class="img-wrapper">
                        <img src="${p.img}" loading="lazy">
                    </div>
                    <div class="card-details">
                        <span class="p-category">${p.cat}</span>
                        <div class="p-name">${p.name}</div>
                        <div class="price-box">
                            <span class="p-price">${p.price.toLocaleString()} Ø¯.Ø¹</span>
                            <span class="p-old-price">${p.oldPrice.toLocaleString()}</span>
                        </div>
                        <button class="add-to-cart-btn" onclick="Titan.UI.AddToCart(${p.id})">
                            <i class="fa-solid fa-cart-plus"></i> Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©
                        </button>
                    </div>
                </div>
            `).join('');
        },

        AddToCart: (id) => {
            const prod = state.products.find(p => p.id === id);
            const exists = state.cart.find(c => c.id === id);
            if(exists) exists.qty++; else state.cart.push({...prod, qty: 1, cartId: Date.now()});
            
            Engine.Save(); UI.UpdateCartView();
            UI.Notify("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’");
        },

        UpdateCartView: () => {
            const list = document.getElementById('cartList');
            const totalText = document.getElementById('cartTotalText');
            const badge = document.getElementById('cartBadge');

            badge.innerText = state.cart.reduce((s, i) => s + i.qty, 0);
            
            list.innerHTML = state.cart.map(i => `
                <div style="display:flex; gap:15px; margin-bottom:20px; align-items:center; border-bottom:1px solid #f0f0f0; padding-bottom:10px;">
                    <img src="${i.img}" style="width:65px; height:65px; border-radius:12px; object-fit:cover;">
                    <div style="flex:1">
                        <div style="font-weight:700; font-size:14px;">${i.name}</div>
                        <div style="color:var(--accent-gold); font-weight:900;">${(i.price * i.qty).toLocaleString()} Ø¯.Ø¹</div>
                        <div style="display:flex; align-items:center; gap:12px; margin-top:8px;">
                            <button onclick="Titan.UI.ChangeQty(${i.cartId}, -1)" style="border:none; width:25px; height:25px; border-radius:5px;">-</button>
                            <b>${i.qty}</b>
                            <button onclick="Titan.UI.ChangeQty(${i.cartId}, 1)" style="border:none; width:25px; height:25px; border-radius:5px;">+</button>
                        </div>
                    </div>
                    <i class="fa-solid fa-trash" style="color:red; cursor:pointer;" onclick="Titan.UI.RemoveItem(${i.cartId})"></i>
                </div>
            `).join('');

            const subTotal = state.cart.reduce((s, i) => s + (i.price * i.qty), 0);
            totalText.innerText = subTotal.toLocaleString() + " Ø¯.Ø¹";
        },

        ChangeQty: (cid, val) => {
            const item = state.cart.find(x => x.cartId === cid);
            item.qty += val;
            if(item.qty < 1) state.cart = state.cart.filter(x => x.cartId !== cid);
            Engine.Save(); UI.UpdateCartView();
        },

        RemoveItem: (cid) => {
            state.cart = state.cart.filter(x => x.cartId !== cid);
            Engine.Save(); UI.UpdateCartView();
        },

        ToggleCart: () => {
            document.getElementById('cartOverlay').toggleAttribute('style');
            document.getElementById('cartPanel').classList.toggle('active');
            UI.UpdateCartView();
        },

        OpenCheckout: () => {
            if(state.cart.length === 0) return UI.Notify("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!", "error");
            UI.ToggleCart();
            const sub = state.cart.reduce((s, i) => s + (i.price * i.qty), 0);
            const fee = sub >= state.settings.freeDeliveryThreshold ? 0 : state.settings.deliveryFee;

            const html = `
                <h2 style="margin-top:0"><i class="fa-solid fa-file-invoice"></i> Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
                <div class="invoice-box">
                    ${state.cart.map(i => `<div style="display:flex; justify-content:space-between;"><span>${i.name} (x${i.qty})</span><span>${(i.price * i.qty).toLocaleString()}</span></div>`).join('')}
                    <hr>
                    <div style="display:flex; justify-content:space-between;"><span>Ø£Ø¬ÙˆØ± Ø§Ù„ØªÙˆØµÙŠÙ„:</span><span>${fee === 0 ? 'Ù…Ø¬Ø§Ù†ÙŠ' : fee}</span></div>
                    <div style="display:flex; justify-content:space-between; font-weight:900; font-size:20px; margin-top:10px;"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span>${(sub+fee).toLocaleString()} Ø¯.Ø¹</span></div>
                </div>
                <div style="margin-top:25px;">
                    <div class="form-group"><label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</label><input id="chk-name" class="form-control" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"></div>
                    <div class="form-group"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø¹Ø±Ø§Ù‚ÙŠ</label><input id="chk-phone" class="form-control" maxlength="11" placeholder="07xxxxxxxx"></div>
                    <div class="form-group">
                        <label>Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</label>
                        <select id="chk-city" class="form-control">
                            <option>Ø¨ØºØ¯Ø§Ø¯</option><option>Ø§Ù„Ø¨ØµØ±Ø©</option><option>Ù†ÙŠÙ†ÙˆÙ‰</option><option>Ø£Ø±Ø¨ÙŠÙ„</option><option>Ø§Ù„Ù†Ø¬Ù</option>
                            <option>ÙƒØ±Ø¨Ù„Ø§Ø¡</option><option>Ø°ÙŠ Ù‚Ø§Ø±</option><option>Ø¨Ø§Ø¨Ù„</option><option>Ø§Ù„Ø£Ù†Ø¨Ø§Ø±</option><option>ÙƒØ±ÙƒÙˆÙƒ</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label><textarea id="chk-addr" class="form-control" rows="2"></textarea></div>
                    <button class="add-to-cart-btn" id="submitOrderBtn" onclick="Titan.UI.SubmitOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø´ÙØ±</button>
                    <button onclick="Titan.UI.CloseModal()" style="width:100%; background:none; border:none; margin-top:10px; color:#888; cursor:pointer;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ù„Ø©</button>
                </div>
            `;
            UI.ShowModal(html);
        },

        SubmitOrder: () => {
            const n = document.getElementById('chk-name').value;
            const p = document.getElementById('chk-phone').value;
            const c = document.getElementById('chk-city').value;
            const a = document.getElementById('chk-addr').value;

            if(!n || p.length < 11) return UI.Notify("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­", "error");

            const btn = document.getElementById('submitOrderBtn');
            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

            const total = state.cart.reduce((s, i) => s + (i.price * i.qty), 0) + (state.cart.reduce((s, i) => s + (i.price * i.qty), 0) >= 150000 ? 0 : 5000);
            
            const orderTemplate = {
                order_id: "TN-" + Math.floor(1000 + Math.random() * 9000),
                customer: n,
                phone: p,
                details: state.cart.map(i => `${i.name} (x${i.qty})`).join(' , '),
                total_price: total.toLocaleString() + " Ø¯.Ø¹",
                address: `${c} - ${a}`
            };

            emailjs.send("service_ga7ytjo", "template_lgvpsns", {
                from_name: orderTemplate.customer,
                phone: orderTemplate.phone,
                address: orderTemplate.address,
                message: `Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${orderTemplate.order_id} | Ø§Ù„Ù…ÙˆØ§Ø¯: ${orderTemplate.details} | Ø§Ù„Ù…Ø¨Ù„Øº: ${orderTemplate.total_price}`,
                title: "Ø·Ù„Ø¨ Ø´Ø±ÙƒØ© ØªÙŠØªØ§Ù† Ø¬Ø¯ÙŠØ¯"
            }).then(() => {
                state.orders.push(orderTemplate);
                state.cart = [];
                Engine.Save();
                UI.ShowModal(`
                    <div style="text-align:center;">
                        <i class="fa-solid fa-circle-check" style="font-size:60px; color:var(--success-green);"></i>
                        <h2>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h2>
                        <p>Ø±Ù‚Ù… ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ: <b>${orderTemplate.order_id}</b></p>
                        <button onclick="location.reload()" class="add-to-cart-btn">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                    </div>
                `);
            });
        },

        SetCategory: (c) => {
            state.activeCategory = c;
            UI.RenderCategories();
            UI.RenderProducts();
        },

        ToggleAdmin: () => {
            const pass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø¯ÙŠØ±:");
            if(pass === "1122") {
                document.getElementById('storefront').style.display = 'none';
                document.getElementById('adminHub').style.display = 'block';
                UI.UpdateStats();
            } else { UI.Notify("ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø®Ø§Ø·Ø¦!", "error"); }
        },

        UpdateStats: () => {
            document.getElementById('stat-products').innerText = state.products.length;
            document.getElementById('stat-orders').innerText = state.orders.length;
            const rev = state.orders.reduce((s, o) => s + parseInt(o.total_price.replace(/,/g, '')), 0);
            document.getElementById('stat-revenue').innerText = rev.toLocaleString() + " Ø¯.Ø¹";
        },

        ShowModal: (html) => {
            const m = document.getElementById('masterModal');
            document.getElementById('modalTarget').innerHTML = html;
            m.style.display = 'flex';
        },

        CloseModal: () => document.getElementById('masterModal').style.display = 'none',

        Notify: (msg, type = "success") => {
            const toast = document.createElement('div');
            toast.style = `position:fixed; top:30px; left:50%; transform:translateX(-50%); 
                          background:${type === 'success' ? '#000' : 'red'}; color:#fff; padding:12px 30px; 
                          border-radius:50px; z-index:99999; font-weight:700; box-shadow:0 10px 30px rgba(0,0,0,0.2);`;
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 3000);
        }
    };

    return { Engine, UI };
})();

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
window.onload = Titan.Engine.Init;
</script>
</body>
</html>
