<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TITAN | Cyber-Architecture</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- CSS VARIABLES & THEME CONFIG --- */
        :root {
            --bg-body: #f4f5f7;
            --bg-card: #ffffff;
            --bg-glass: rgba(255, 255, 255, 0.95);
            --primary: #111111;
            --accent: #dfa630;
            --accent-hover: #b88620;
            --text-main: #1f2937;
            --text-sub: #6b7280;
            --border: #e5e7eb;
            --danger: #ef4444;
            --success: #10b981;
            --warning: #f59e0b;
            --radius: 12px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.04);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body {
            margin: 0; font-family: 'Cairo', sans-serif; background: var(--bg-body);
            color: var(--text-main); font-size: 14px; overflow-x: hidden;
        }

        /* --- UI COMPONENTS --- */
        .btn {
            border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer;
            transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); color: var(--accent); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .btn-danger { background: #fee2e2; color: var(--danger); }
        .btn-ghost { background: transparent; color: var(--text-sub); }

        .input-field {
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px;
            background: #fff; font-family: inherit; transition: 0.2s;
        }
        .input-field:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(223, 166, 48, 0.1); }

        /* --- HEADER & NAV --- */
        .cyber-header {
            position: sticky; top: 0; z-index: 900; background: var(--bg-glass);
            backdrop-filter: blur(12px); border-bottom: 1px solid var(--border);
            padding: 12px 5%; display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-size: 20px; font-weight: 900; letter-spacing: -0.5px; }
        .logo span { color: var(--accent); }
        
        .nav-tools { display: flex; gap: 15px; }
        .nav-item { position: relative; cursor: pointer; font-size: 18px; color: var(--text-main); }
        .badge-counter {
            position: absolute; top: -5px; right: -8px; background: var(--accent); color: #000;
            font-size: 10px; font-weight: bold; height: 16px; min-width: 16px; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; padding: 0 4px;
        }

        /* --- CATEGORY BAR --- */
        .cat-scroll {
            display: flex; gap: 10px; overflow-x: auto; padding: 15px 5%;
            background: var(--bg-card); border-bottom: 1px solid var(--border);
            scrollbar-width: none;
        }
        .cat-chip {
            padding: 6px 16px; border-radius: 20px; background: #f3f4f6; font-size: 12px;
            font-weight: 600; white-space: nowrap; cursor: pointer; transition: 0.2s;
        }
        .cat-chip.active { background: var(--primary); color: var(--accent); }

        /* --- PRODUCT GRID --- */
        .grid-layout {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 15px; padding: 20px 5%;
        }
        .product-card {
            background: var(--bg-card); border-radius: var(--radius); overflow: hidden;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border); position: relative;
            transition: var(--transition);
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        
        .card-img-box { height: 180px; width: 100%; overflow: hidden; background: #f9fafb; position: relative; }
        .card-img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .product-card:hover img { transform: scale(1.1); }
        
        .stock-badge {
            position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: #fff;
            padding: 2px 8px; border-radius: 4px; font-size: 10px; backdrop-filter: blur(4px);
        }
        .stock-low { background: var(--danger); }

        .card-info { padding: 12px; }
        .card-title { font-weight: 700; font-size: 13px; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-price { color: var(--primary); font-weight: 900; font-size: 15px; }

        /* --- MODAL SYSTEM --- */
        .modal-backdrop {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 2000; display: none; align-items: center; justify-content: center; opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-backdrop.open { display: flex; opacity: 1; }
        
        .modal-panel {
            background: var(--bg-card); width: 100%; max-width: 500px; border-radius: 20px;
            padding: 25px; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            transform: scale(0.95); transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            max-height: 90vh; overflow-y: auto;
        }
        .modal-backdrop.open .modal-panel { transform: scale(1); }

        /* --- VARIANTS & DETAILS --- */
        .variant-group { margin: 15px 0; }
        .v-label { font-size: 12px; font-weight: 700; color: var(--text-sub); display: block; margin-bottom: 8px; }
        .v-options { display: flex; gap: 8px; flex-wrap: wrap; }
        .v-chip {
            border: 1px solid var(--border); padding: 8px 12px; border-radius: 8px; cursor: pointer;
            font-size: 12px; transition: 0.2s; user-select: none;
        }
        .v-chip.selected { border-color: var(--accent); background: #fffbeb; color: #b45309; font-weight: 700; }

        /* --- ADMIN DASHBOARD --- */
        #admin-interface { display: none; background: #f8fafc; min-height: 100vh; padding: 20px; }
        .chart-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .kpi-card { background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .kpi-val { font-size: 20px; font-weight: 900; color: var(--primary); margin-top: 5px; }
        .status-select { padding: 5px; border-radius: 6px; font-size: 11px; font-weight: bold; border: 1px solid #ddd; }
    </style>
</head>
<body>

<div id="root">
    
    <header class="cyber-header">
        <div class="logo" onclick="location.reload()">TITAN<span>.OS</span></div>
        <div class="nav-tools">
            <div class="nav-item" id="admin-lock" style="opacity: 0.2;" title="Secured"><i class="fa-solid fa-shield-cat"></i></div>
            <div class="nav-item" onclick="Titan.UI.OpenOrders()"><i class="fa-solid fa-box-open"></i></div>
            <div class="nav-item" onclick="Titan.UI.OpenCart()">
                <i class="fa-solid fa-bag-shopping"></i>
                <span class="badge-counter" id="cart-counter">0</span>
            </div>
        </div>
    </header>

    <div class="cat-scroll" id="category-container"></div>

    <main class="grid-layout" id="products-container"></main>

    <section id="admin-interface">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h2 style="margin:0"><i class="fa-solid fa-chart-pie"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            <button class="btn btn-danger" onclick="location.reload()" style="font-size:12px;">Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†</button>
        </div>
        
        <div class="chart-grid">
            <div class="kpi-card"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„</span><div class="kpi-val" id="kpi-revenue">0</div></div>
            <div class="kpi-card"><span>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span><div class="kpi-val" id="kpi-orders">0</div></div>
            <div class="kpi-card"><span>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</span><div class="kpi-val" id="kpi-stock">0</div></div>
        </div>

        <div style="background:#fff; border-radius:12px; overflow:hidden; border:1px solid #e2e8f0;">
            <table style="width:100%; border-collapse:collapse; font-size:12px; text-align:right;">
                <thead style="background:#f1f5f9;">
                    <tr><th style="padding:10px;">ID</th><th>Ø§Ù„Ø²Ø¨ÙˆÙ†</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>
                </thead>
                <tbody id="admin-orders-list"></tbody>
            </table>
        </div>
    </section>

    <div class="modal-backdrop" id="main-modal" onclick="if(event.target==this) Titan.UI.CloseModal()">
        <div class="modal-panel" id="modal-content"></div>
    </div>

</div>

<script>
/**
 * TITAN CORE | Cyber-Architecture v2.0
 * Developed with Reactive State & Security First Approach
 */

const Titan = (() => {
    
    // --- 1. REACTIVE STATE ENGINE ---
    // Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­Ø±Ùƒ ÙŠØ±Ø§Ù‚Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆÙŠØ­Ø¯Ø« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø£ÙŠ ØªØºÙŠÙŠØ±
    const Store = {
        data: {
            products: JSON.parse(localStorage.getItem('tt_inventory')) || [
                {id: 101, n: "Ø³Ø§Ø¹Ø© Ø±ÙˆÙ„ÙƒØ³ Ø¯Ø§ÙŠØªÙˆÙ†Ø§", p: 450000, c: "Ø³Ø§Ø¹Ø§Øª", stock: 5, img: "https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=500", opts: {colors:['Gold','Silver'], sizes:['40mm']}},
                {id: 102, n: "Ø¹Ø·Ø± ØªÙˆÙ… ÙÙˆØ±Ø¯ Ø¹ÙˆØ¯", p: 210000, c: "Ø¹Ø·ÙˆØ±", stock: 12, img: "https://images.unsplash.com/photo-1594035910387-fea477942698?w=500", opts: {colors:['Standard'], sizes:['50ml','100ml']}},
                {id: 103, n: "Ù†Ø§ÙŠÙƒÙŠ Ø¥ÙŠØ± Ø¬ÙˆØ±Ø¯Ù†", p: 85000, c: "Ø£Ø­Ø°ÙŠØ©", stock: 8, img: "https://images.unsplash.com/photo-1552346154-21d32810aba3?w=500", opts: {colors:['Red','Black','White'], sizes:['40','41','42','43','44']}},
                {id: 104, n: "Ø³Ù…Ø§Ø¹Ø© Ø¢Ø¨Ù„ Ù…Ø§ÙƒØ³", p: 320000, c: "Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª", stock: 4, img: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500", opts: {colors:['Space Gray','Silver'], sizes:['Standard']}}
            ],
            cart: JSON.parse(localStorage.getItem('tt_cart')) || [],
            orders: JSON.parse(localStorage.getItem('tt_orders')) || [],
            activeCat: 'Ø§Ù„ÙƒÙ„'
        },
        
        save() {
            localStorage.setItem('tt_inventory', JSON.stringify(this.data.products));
            localStorage.setItem('tt_cart', JSON.stringify(this.data.cart));
            localStorage.setItem('tt_orders', JSON.stringify(this.data.orders));
            UI.UpdateBadges();
        }
    };

    // --- 2. SECURITY LAYER ---
    const Security = {
        sanitize: (str) => {
            const div = document.createElement('div');
            div.innerText = str;
            return div.innerHTML.replace(/'/g, "&#39;").replace(/"/g, "&quot;");
        },
        
        generateHash: () => {
            return 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        },

        initAdminLock: () => {
            let clicks = 0;
            document.getElementById('admin-lock').addEventListener('click', () => {
                clicks++;
                if (clicks === 5) {
                    const pin = prompt("ğŸ” SECURE ACCESS REQUIRED\nEnter PIN:");
                    if (pin === "1122") Admin.init();
                    clicks = 0;
                }
            });
        }
    };

    // --- 3. UI RENDERER ---
    const UI = {
        init: () => {
            UI.RenderCats();
            UI.RenderGrid();
            UI.UpdateBadges();
            Security.initAdminLock();
            emailjs.init("YXDPYRNxazZ45eYWS");
        },

        RenderCats: () => {
            const cats = ['Ø§Ù„ÙƒÙ„', ...new Set(Store.data.products.map(p => p.c))];
            document.getElementById('category-container').innerHTML = cats.map(c => 
                `<div class="cat-chip ${Store.data.activeCat === c ? 'active' : ''}" onclick="Titan.Logic.Filter('${c}')">${c}</div>`
            ).join('');
        },

        RenderGrid: () => {
            const list = Store.data.activeCat === 'Ø§Ù„ÙƒÙ„' ? Store.data.products : Store.data.products.filter(p => p.c === Store.data.activeCat);
            document.getElementById('products-container').innerHTML = list.map(p => `
                <div class="product-card" onclick="Titan.UI.ProductDetails(${p.id})">
                    <div class="card-img-box">
                        <img src="${p.img}" loading="lazy">
                        <span class="stock-badge ${p.stock < 5 ? 'stock-low' : ''}">${p.stock > 0 ? 'Ù…ØªÙˆÙØ±: '+p.stock : 'Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©'}</span>
                    </div>
                    <div class="card-info">
                        <div class="card-title">${p.n}</div>
                        <div class="card-price">${p.p.toLocaleString()} Ø¯.Ø¹</div>
                    </div>
                </div>
            `).join('');
        },

        ProductDetails: (id) => {
            const p = Store.data.products.find(x => x.id === id);
            if(p.stock <= 0) return alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹.");
            
            // Default selection
            let selColor = p.opts.colors[0], selSize = p.opts.sizes[0];
            
            const renderModal = () => `
                <div style="display:flex; gap:15px; margin-bottom:20px;">
                    <img src="${p.img}" style="width:80px; height:80px; border-radius:12px; object-fit:cover;">
                    <div>
                        <h3 style="margin:0; font-size:16px;">${p.n}</h3>
                        <div style="color:var(--accent); font-weight:900; font-size:18px;">${p.p.toLocaleString()} Ø¯.Ø¹</div>
                        <div style="font-size:11px; color:#666;">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${p.stock}</div>
                    </div>
                </div>
                
                <div class="variant-group">
                    <label class="v-label">Ø§Ù„Ù„ÙˆÙ†</label>
                    <div class="v-options" id="color-opts">
                        ${p.opts.colors.map(c => `<div class="v-chip ${c===selColor?'selected':''}" onclick="selColor='${c}'; this.parentNode.childNodes.forEach(n=>n.classList?.remove('selected')); this.classList.add('selected');">${c}</div>`).join('')}
                    </div>
                </div>
                
                <div class="variant-group">
                    <label class="v-label">Ø§Ù„Ù‚ÙŠØ§Ø³ / Ø§Ù„Ø­Ø¬Ù…</label>
                    <div class="v-options" id="size-opts">
                        ${p.opts.sizes.map(s => `<div class="v-chip ${s===selSize?'selected':''}" onclick="selSize='${s}'; this.parentNode.childNodes.forEach(n=>n.classList?.remove('selected')); this.classList.add('selected');">${s}</div>`).join('')}
                    </div>
                </div>

                <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="Titan.Logic.AddToCart(${p.id}, selColor, selSize)">
                    <i class="fa-solid fa-cart-plus"></i> ØªØ£ÙƒÙŠØ¯ ÙˆØ¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©
                </button>
            `;
            
            // Expose vars to window scope temporarily for the inline onclick (hacky but compact)
            window.selColor = selColor; window.selSize = selSize;
            UI.OpenModal(renderModal());
        },

        OpenCart: () => {
            if(Store.data.cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!");
            const total = Store.data.cart.reduce((a,b)=>a+b.p,0);
            
            const html = `
                <h3 style="margin-top:0">Ø­Ù‚ÙŠØ¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚ (${Store.data.cart.length})</h3>
                <div style="max-height:400px; overflow-y:auto; padding-right:5px;">
                    ${Store.data.cart.map((item, idx) => `
                        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding:10px 0;">
                            <div style="display:flex; gap:10px; align-items:center;">
                                <div style="width:40px; height:40px; background:#f0f0f0; border-radius:8px; overflow:hidden;"><img src="${item.img}" style="width:100%;"></div>
                                <div>
                                    <div style="font-weight:bold; font-size:12px;">${item.n}</div>
                                    <div style="font-size:10px; color:#888;">${item.selColor} | ${item.selSize}</div>
                                </div>
                            </div>
                            <div style="text-align:left;">
                                <div style="font-weight:bold;">${item.p.toLocaleString()}</div>
                                <i class="fa-solid fa-trash" style="color:var(--danger); cursor:pointer; font-size:12px; margin-top:5px;" onclick="Titan.Logic.RemoveFromCart(${item.cartId})"></i>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top:20px; border-top:2px dashed #eee; padding-top:15px;">
                    <div style="display:flex; justify-content:space-between; font-weight:900; font-size:16px;">
                        <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ:</span>
                        <span>${total.toLocaleString()} Ø¯.Ø¹</span>
                    </div>
                    <button class="btn btn-primary" style="width:100%; margin-top:15px;" onclick="Titan.UI.OpenCheckout()">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø´Ø±Ø§Ø¡</button>
                </div>
            `;
            UI.OpenModal(html);
        },

        OpenCheckout: () => {
            const html = `
                <h3><i class="fa-solid fa-truck-fast"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</h3>
                <div style="display:flex; flex-direction:column; gap:12px;">
                    <input id="cx-name" class="input-field" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
                    <input id="cx-phone" class="input-field" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø¶Ø±ÙˆØ±ÙŠ)">
                    <select id="cx-city" class="input-field">
                        <option>Ø¨ØºØ¯Ø§Ø¯</option><option>Ø§Ù„Ø¨ØµØ±Ø©</option><option>Ø£Ø±Ø¨ÙŠÙ„</option><option>Ø§Ù„Ù†Ø¬Ù</option><option>Ø§Ù„Ù…ÙˆØµÙ„</option>
                    </select>
                    <textarea id="cx-addr" class="input-field" rows="3" placeholder="Ø£Ù‚Ø±Ø¨ Ù†Ù‚Ø·Ø© Ø¯Ø§Ù„Ø©..."></textarea>
                    <button class="btn btn-primary" onclick="Titan.Logic.SubmitOrder()">ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            `;
            UI.OpenModal(html);
        },

        OpenOrders: () => {
            if(Store.data.orders.length === 0) return alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©.");
            const html = `
                <h3>Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
                ${Store.data.orders.map(o => `
                    <div style="background:#f9f9f9; padding:12px; border-radius:8px; margin-bottom:10px; border:1px solid #eee;">
                        <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:12px;">
                            <span>#${o.id}</span>
                            <span style="color:${o.status==='Ù…Ù„ØºÙŠ'?'red':o.status==='ÙˆØ§ØµÙ„'?'green':'orange'}">${o.status}</span>
                        </div>
                        <div style="font-size:11px; margin:5px 0; color:#555;">${o.items}</div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
                            <b>${o.total.toLocaleString()} Ø¯.Ø¹</b>
                            ${o.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' ? `<button class="btn btn-danger" style="padding:4px 10px; font-size:10px;" onclick="Titan.Logic.CancelOrder('${o.id}')">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨</button>` : ''}
                        </div>
                    </div>
                `).join('')}
            `;
            UI.OpenModal(html);
        },

        OpenModal: (content) => {
            document.getElementById('modal-content').innerHTML = content;
            const backdrop = document.getElementById('main-modal');
            backdrop.style.display = 'flex';
            setTimeout(() => backdrop.classList.add('open'), 10);
        },
        CloseModal: () => {
            const backdrop = document.getElementById('main-modal');
            backdrop.classList.remove('open');
            setTimeout(() => backdrop.style.display = 'none', 300);
        },
        UpdateBadges: () => {
            document.getElementById('cart-counter').innerText = Store.data.cart.length;
        }
    };

    // --- 4. BUSINESS LOGIC ---
    const Logic = {
        Filter: (c) => { Store.data.activeCat = c; UI.RenderCats(); UI.RenderGrid(); },
        
        AddToCart: (pid, color, size) => {
            const product = Store.data.products.find(p => p.id === pid);
            if(product.stock <= 0) return alert("Ù†ÙØ°Øª Ø§Ù„ÙƒÙ…ÙŠØ©!");

            Store.data.cart.push({
                ...product,
                selColor: window.selColor, // Taken from global scope
                selSize: window.selSize,
                cartId: Date.now()
            });
            
            // Fake stock reduction locally for UI effect
            product.stock--;
            
            Store.save();
            UI.CloseModal();
            UI.RenderGrid(); // Re-render to update stock badges
            // Custom toast
            const toast = document.createElement('div');
            toast.innerText = `âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${product.n}`;
            toast.style = "position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:#000; color:#fff; padding:10px 20px; border-radius:30px; z-index:9999;";
            document.body.appendChild(toast);
            setTimeout(()=>toast.remove(), 2000);
        },

        RemoveFromCart: (cid) => {
            // Restore stock (logic simplified)
            const item = Store.data.cart.find(i => i.cartId === cid);
            const prod = Store.data.products.find(p => p.id === item.id);
            if(prod) prod.stock++;
            
            Store.data.cart = Store.data.cart.filter(c => c.cartId !== cid);
            Store.save();
            UI.OpenCart(); // Refresh cart view
            UI.RenderGrid();
        },

        SubmitOrder: () => {
            const name = Security.sanitize(document.getElementById('cx-name').value);
            const phone = Security.sanitize(document.getElementById('cx-phone').value);
            const city = document.getElementById('cx-city').value;
            const addr = Security.sanitize(document.getElementById('cx-addr').value);

            if(!name || phone.length < 10) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©.");

            const order = {
                id: Security.generateHash(),
                customer: { name, phone, city, addr },
                items: Store.data.cart.map(i => `${i.n} (${i.selColor}/${i.selSize})`).join(' + '),
                total: Store.data.cart.reduce((a,b)=>a+b.p,0),
                status: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
                timestamp: new Date().toLocaleString()
            };

            // Send Email (Simulated)
            emailjs.send("service_ga7ytjo", "template_lgvpsns", {
                order_id: order.id,
                from_name: name,
                message: `${order.items} | Total: ${order.total}`,
                phone: phone
            });

            Store.data.orders.unshift(order);
            Store.data.cart = [];
            Store.save();
            UI.CloseModal();
            alert("ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹: " + order.id);
        },

        CancelOrder: (oid) => {
            if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
            const order = Store.data.orders.find(o => o.id === oid);
            if(order) {
                order.status = 'Ù…Ù„ØºÙŠ';
                Store.save();
                UI.OpenOrders();
            }
        }
    };

    // --- 5. ADMIN SYSTEM ---
    const Admin = {
        init: () => {
            document.getElementById('root').style.display = 'none';
            document.getElementById('admin-interface').style.display = 'block';
            Admin.renderDashboard();
        },
        renderDashboard: () => {
            // Stats
            document.getElementById('kpi-revenue').innerText = Store.data.orders.filter(o=>o.status!=='Ù…Ù„ØºÙŠ').reduce((a,b)=>a+b.total,0).toLocaleString();
            document.getElementById('kpi-orders').innerText = Store.data.orders.length;
            document.getElementById('kpi-stock').innerText = Store.data.products.reduce((a,b)=>a+b.stock,0);

            // Table
            const tbody = document.getElementById('admin-orders-list');
            tbody.innerHTML = Store.data.orders.map(o => `
                <tr style="border-bottom:1px solid #eee;">
                    <td style="padding:10px;">${o.id}</td>
                    <td>${o.customer.name}<br><small>${o.customer.phone}</small></td>
                    <td>
                        <select class="status-select" onchange="Titan.Admin.updateStatus('${o.id}', this.value)" style="background:${o.status==='Ù…Ù„ØºÙŠ'?'#fee2e2':'#fff'}">
                            <option ${o.status==='Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±'?'selected':''}>Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option ${o.status==='ØªÙ… Ø§Ù„Ø´Ø­Ù†'?'selected':''}>ØªÙ… Ø§Ù„Ø´Ø­Ù†</option>
                            <option ${o.status==='ÙˆØ§ØµÙ„'?'selected':''}>ÙˆØ§ØµÙ„</option>
                            <option ${o.status==='Ù…Ù„ØºÙŠ'?'selected':''}>Ù…Ù„ØºÙŠ</option>
                        </select>
                    </td>
                    <td><i class="fa-solid fa-trash" style="color:red; cursor:pointer;" onclick="Titan.Admin.deleteOrder('${o.id}')"></i></td>
                </tr>
            `).join('');
        },
        updateStatus: (oid, val) => {
            const order = Store.data.orders.find(o => o.id === oid);
            order.status = val;
            Store.save();
            Admin.renderDashboard();
        },
        deleteOrder: (oid) => {
            if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) {
                Store.data.orders = Store.data.orders.filter(o => o.id !== oid);
                Store.save();
                Admin.renderDashboard();
            }
        }
    };

    // Public API
    return { UI, Logic, Admin };

})();

// Boot System
window.onload = Titan.UI.init;

</script>
</body>
</html>
