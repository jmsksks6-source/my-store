<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Elite Store Pro | Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --danger: #dc3545; --dark: #1a1a1a; --gold: #c5a059; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; background: #f4f7f6; color: #333; }
        .screen { display: none; padding: 15px; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        header { background: var(--dark); color: white; padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; position: sticky; top:0; z-index:1000; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        .badge { background: var(--gold); color: black; font-size: 11px; padding: 2px 7px; border-radius: 50%; position: absolute; top: -5px; right: -10px; font-weight: bold; }
        .cats-bar { display: flex; gap: 10px; overflow-x: auto; padding: 15px 0; scrollbar-width: none; }
        .cat-item { background: white; padding: 8px 18px; border-radius: 25px; cursor: pointer; white-space: nowrap; border: 1px solid #ddd; transition: 0.3s; }
        .cat-item.active { background: var(--gold); color: black; border-color: var(--gold); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; }
        .product { background: white; border-radius: 15px; padding: 12px; border: 1px solid #eee; text-align: center; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .product img { width: 100%; height: 160px; object-fit: cover; border-radius: 10px; }
        .out-of-stock { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.7); display: flex; align-items: center; justify-content: center; font-weight: bold; color: red; border-radius: 15px; z-index: 2; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 90%; max-width: 450px; padding: 25px; border-radius: 20px; max-height: 85vh; overflow-y: auto; }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        .btn { border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; }
        .btn-p { background: var(--dark); color: white; }
        .btn-g { background: var(--gold); color: black; }
        .qty-btn { width: 30px; height: 30px; border-radius: 5px; border: 1px solid #ddd; background: #eee; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-screen" class="screen">
    <div style="text-align: center; margin-top: 80px; padding: 20px;">
        <h1 style="color:var(--dark)">ELITE STORE</h1>
        <div style="background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ / Ø¯Ø®ÙˆÙ„</h3>
            <input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
            <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ)">
            <input type="password" id="reg-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn btn-p" onclick="handleAuth()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ØªØ¬Ø±</button>
        </div>
    </div>
</div>

<div id="main-app" class="screen">
    <header>
        <b onclick="showPage('home')" style="cursor:pointer; font-size: 20px; letter-spacing: 1px;">ELITE PRO</b>
        <div style="display:flex; gap:18px; align-items:center;">
            <span onclick="showPage('orders')" style="cursor:pointer;">ğŸ“‹</span>
            <div style="position:relative; cursor:pointer;" onclick="openCart()">ğŸ›’ <span class="badge" id="cart-count">0</span></div>
            <span id="admin-btn" onclick="showPage('admin')" style="display:none; color:var(--gold); font-weight:bold; cursor:pointer;">âš™ï¸</span>
        </div>
    </header>

    <div id="home-page" class="page active">
        <div class="cats-bar" id="cats-bar"></div>
        <div class="grid" id="p-grid"></div>
    </div>

    <div id="orders-page" class="page" style="display:none;">
        <h3>Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§ØªÙŠ</h3>
        <div id="orders-list"></div>
    </div>

    <div id="admin-page" class="page" style="display:none;">
        <div style="background:white; padding:15px; border-radius:15px; border:1px solid #ddd;">
            <h4>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h4>
            <input type="text" id="adm-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
            <input type="number" id="adm-price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
            <input type="text" id="adm-img" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
            <select id="adm-cat">
                <option>Ø³Ø§Ø¹Ø§Øª</option><option>Ù…Ù„Ø§Ø¨Ø³</option><option>Ø£Ø­Ø°ÙŠØ©</option><option>Ø¹Ø·ÙˆØ±</option><option>Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</option>
            </select>
            <input type="text" id="adm-colors" placeholder="Ø§Ù„Ø£Ù„ÙˆØ§Ù† (ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)">
            <input type="text" id="adm-sizes" placeholder="Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª (ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)">
            <button class="btn btn-p" onclick="saveNewProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>
        </div>
        <hr>
        <h4>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†</h4>
        <div id="admin-inventory"></div>
    </div>
</div>

<div id="opt-modal" class="modal">
    <div class="modal-content">
        <h3 id="opt-title"></h3>
        <label>Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†:</label><select id="opt-color"></select>
        <div id="size-div"><label>Ø§Ø®ØªØ± Ø§Ù„Ù‚ÙŠØ§Ø³:</label><select id="opt-size"></select></div>
        <button class="btn btn-g" onclick="confirmAdd()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
        <button class="btn" style="background:none" onclick="closeModals()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<div id="cart-modal" class="modal">
    <div class="modal-content">
        <h3>ğŸ›’ Ø³Ù„Ø© Ø§Ù„ØªØ³ÙˆÙ‚</h3>
        <div id="cart-list"></div>
        <div style="background:#f9f9f9; padding:15px; border-radius:10px; margin:15px 0;">
            <div style="display:flex; justify-content:space-between;"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span> <b id="total-val">0</b></div>
            <div style="font-size:12px; color:gray;">+ ØªÙˆØµÙŠÙ„ Ø«Ø§Ø¨Øª 5,000 Ø¯.Ø¹ Ù„ÙƒØ§ÙØ© Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª</div>
        </div>
        <button class="btn btn-p" onclick="openCheckout()">Ø§Ù„ØªØ§Ù„ÙŠ: Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</button>
        <button class="btn" style="background:none" onclick="closeModals()">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
</div>

<div id="checkout-modal" class="modal">
    <div class="modal-content">
        <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´Ø­Ù†</h3>
        <input type="text" id="f-fullname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ø³ØªÙ„Ù…">
        <input type="text" id="f-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)" maxlength="11" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
        <select id="f-city">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©...</option>
            <option>Ø¨ØºØ¯Ø§Ø¯</option><option>Ø§Ù„Ø¨ØµØ±Ø©</option><option>Ù†ÙŠÙ†ÙˆÙ‰</option><option>Ø£Ø±Ø¨ÙŠÙ„</option><option>Ø§Ù„Ù†Ø¬Ù</option>
            <option>ÙƒØ±Ø¨Ù„Ø§Ø¡</option><option>Ø°ÙŠ Ù‚Ø§Ø±</option><option>ÙƒØ±ÙƒÙˆÙƒ</option><option>Ø§Ù„Ø£Ù†Ø¨Ø§Ø±</option><option>Ø¨Ø§Ø¨Ù„</option>
            <option>Ø¯ÙŠØ§Ù„Ù‰</option><option>Ù…ÙŠØ³Ø§Ù†</option><option>Ø§Ù„Ø¯ÙŠÙˆØ§Ù†ÙŠØ©</option><option>ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†</option><option>Ø¯Ù‡ÙˆÙƒ</option>
            <option>Ø§Ù„Ø³Ù„ÙŠÙ…Ø§Ù†ÙŠØ©</option><option>ÙˆØ§Ø³Ø·</option><option>Ø§Ù„Ù…Ø«Ù†Ù‰</option>
        </select>
        <input type="text" id="f-point" placeholder="Ø£Ù‚Ø±Ø¨ Ù†Ù‚Ø·Ø© Ø¯Ø§Ù„Ø©">
        <textarea id="f-notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
        <button class="btn btn-g" id="final-btn" onclick="submitOrder()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ âœ…</button>
        <button class="btn" style="background:none" onclick="closeModals()">ØªØ±Ø§Ø¬Ø¹</button>
    </div>
</div>

<script>
    emailjs.init("YXDPYRNxazZ45eYWS");

    let productsList = JSON.parse(localStorage.getItem('elite_p')) || [
        {id:1, title:"Ø³Ø§Ø¹Ø© Ø±ÙˆÙ„ÙƒØ³ Ø¯ÙŠØª Ø¬Ø³Øª", price:150000, cat:"Ø³Ø§Ø¹Ø§Øª", img:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?w=400", status:"a", colors:"Ø°Ù‡Ø¨ÙŠ,ÙØ¶ÙŠ", sizes:""},
        {id:2, title:"Ø¹Ø·Ø± Ø³ÙˆÙØ§Ø¬ Ø¯ÙŠÙˆØ±", price:95000, cat:"Ø¹Ø·ÙˆØ±", img:"https://images.unsplash.com/photo-1544467316-145c28d46924?w=400", status:"a", colors:"Ø£Ø²Ø±Ù‚", sizes:""},
        {id:3, title:"Ù‡ÙˆØ¯ÙŠ Ù†Ø§ÙŠÙƒ Ø§Ù„Ø£ØµÙ„ÙŠ", price:35000, cat:"Ù…Ù„Ø§Ø¨Ø³", img:"https://images.unsplash.com/photo-1556821840-3a63f95609a7?w=400", status:"a", colors:"Ø£Ø³ÙˆØ¯,Ø±ØµØ§ØµÙŠ,Ø£Ø¨ÙŠØ¶", sizes:"M,L,XL,XXL"},
        {id:4, title:"Ø­Ø°Ø§Ø¡ Ø¬ÙˆØ±Ø¯Ù† Retro", price:75000, cat:"Ø£Ø­Ø°ÙŠØ©", img:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400", status:"a", colors:"Ø£Ø­Ù…Ø±,Ø£Ø¨ÙŠØ¶", sizes:"40,41,42,43,44"},
        {id:5, title:"Ø³Ù…Ø§Ø¹Ø© Ø¢Ø¨Ù„ Airpods", price:120000, cat:"Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", img:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400", status:"a", colors:"Ø£Ø¨ÙŠØ¶", sizes:""},
        {id:6, title:"Ù†Ø¸Ø§Ø±Ø© Ø±ÙŠØ¨Ø§Ù† Ø´Ù…Ø³ÙŠØ©", price:45000, cat:"Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", img:"https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=400", status:"a", colors:"Ø£Ø³ÙˆØ¯", sizes:""},
        {id:7, title:"Ù‚Ù…ÙŠØµ ÙƒÙ„Ø§Ø³ÙŠÙƒ Ù…Ù„ÙƒÙŠ", price:25000, cat:"Ù…Ù„Ø§Ø¨Ø³", img:"https://images.unsplash.com/photo-1596755094514-f87e34085b2c?w=400", status:"a", colors:"Ø£Ø¨ÙŠØ¶,Ø£Ø²Ø±Ù‚ ÙØ§ØªØ­", sizes:"S,M,L,XL"},
        {id:8, title:"Ø³Ø§Ø¹Ø© Ù‡ÙˆØ¨Ù„ÙˆØª Hublot", price:110000, cat:"Ø³Ø§Ø¹Ø§Øª", img:"https://images.unsplash.com/photo-1548171916-042ad9ef518a?w=400", status:"a", colors:"Ø£Ø³ÙˆØ¯ ÙƒØ§Ù…Ù„,Ø¨Ù†ÙŠ", sizes:""},
        {id:9, title:"Ø­Ø°Ø§Ø¡ ÙƒÙ„Ø§Ø³ÙŠÙƒ Ø¬Ù„Ø¯ Ø·Ø¨ÙŠØ¹ÙŠ", price:55000, cat:"Ø£Ø­Ø°ÙŠØ©", img:"https://images.unsplash.com/photo-1549298916-b41d501d3772?w=400", status:"a", colors:"Ø¨Ù†ÙŠ,Ø£Ø³ÙˆØ¯", sizes:"41,42,43"},
        {id:10, title:"Ø¹Ø·Ø± ÙƒØ±ÙŠØ¯ Ø£ÙÙŠÙ†ØªÙˆØ³", price:180000, cat:"Ø¹Ø·ÙˆØ±", img:"https://images.unsplash.com/photo-1588405863914-22d7631d1414?w=400", status:"a", colors:"ÙØ¶ÙŠ", sizes:""},
        {id:11, title:"Ø®Ø§ØªÙ… ÙØ¶Ø© Ø¹ÙŠØ§Ø± 925", price:40000, cat:"Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", img:"https://images.unsplash.com/photo-1605100804763-247f67b3557e?w=400", status:"a", colors:"ÙØ¶ÙŠ", sizes:"18,19,20,21"},
        {id:12, title:"Ø¨Ù†Ø·Ù„ÙˆÙ† Ø¬ÙŠÙ†Ø² Ù„ÙŠÙØ§ÙŠØ²", price:30000, cat:"Ù…Ù„Ø§Ø¨Ø³", img:"https://images.unsplash.com/photo-1542272604-787c3835535d?w=400", status:"a", colors:"Ø£Ø²Ø±Ù‚", sizes:"32,34,36"},
        {id:13, title:"Ø³Ø§Ø¹Ø© Ø¨Ø§ØªÙŠÙƒ ÙÙŠÙ„ÙŠØ¨", price:250000, cat:"Ø³Ø§Ø¹Ø§Øª", img:"https://images.unsplash.com/photo-1524592091214-8c97afad3d3a?w=400", status:"a", colors:"ÙØ¶ÙŠ,ÙƒØ­Ù„ÙŠ", sizes:""},
        {id:14, title:"Ø­Ù‚ÙŠØ¨Ø© Ø¬Ù„Ø¯ Ø±Ø¬Ø§Ù„ÙŠØ©", price:60000, cat:"Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", img:"https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=400", status:"a", colors:"Ø£Ø³ÙˆØ¯,Ø¨Ù†ÙŠ", sizes:""},
        {id:15, title:"ØªÙŠØ´ÙŠØ±Øª Ø¨ÙˆÙ„Ùˆ Ù…Ø§Ø±ÙƒØ©", price:22000, cat:"Ù…Ù„Ø§Ø¨Ø³", img:"https://images.unsplash.com/photo-1581655353564-df123a1eb820?w=400", status:"a", colors:"Ø£Ø®Ø¶Ø±,Ø£Ø­Ù…Ø±,Ø£Ø²Ø±Ù‚", sizes:"M,L,XL"}
    ];

    let db = {
        user: JSON.parse(localStorage.getItem('elite_u')),
        orders: JSON.parse(localStorage.getItem('elite_o')) || []
    };
    let cart = [];
    let curP = null;

    function handleAuth() {
        const n = document.getElementById('reg-name').value;
        const e = document.getElementById('reg-email').value;
        const p = document.getElementById('reg-pass').value;
        if(!n || !e || !p) return alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„");
        db.user = { name: n, email: e, role: (n.toLowerCase() === 'admin' && p === 'admin') ? 'admin' : 'user' };
        localStorage.setItem('elite_u', JSON.stringify(db.user));
        startApp();
    }

    function startApp() {
        if(!db.user) {
            document.getElementById('auth-screen').classList.add('active');
        } else {
            document.getElementById('auth-screen').classList.remove('active');
            document.getElementById('main-app').classList.add('active');
            if(db.user.role === 'admin') document.getElementById('admin-btn').style.display = 'inline';
            renderCategories();
            renderProducts();
        }
    }

    function renderCategories() {
        const cats = ["Ø§Ù„ÙƒÙ„", "Ø³Ø§Ø¹Ø§Øª", "Ù…Ù„Ø§Ø¨Ø³", "Ø£Ø­Ø°ÙŠØ©", "Ø¹Ø·ÙˆØ±", "Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª"];
        document.getElementById('cats-bar').innerHTML = cats.map(c => `<div class="cat-item" onclick="filterBy('${c}', event)">${c}</div>`).join('');
        document.querySelector('.cat-item').classList.add('active');
    }

    function filterBy(c, e) {
        document.querySelectorAll('.cat-item').forEach(i => i.classList.remove('active'));
        e.target.classList.add('active');
        renderProducts(c);
    }

    function renderProducts(filter = "Ø§Ù„ÙƒÙ„") {
        const g = document.getElementById('p-grid');
        g.innerHTML = productsList.filter(p => filter === "Ø§Ù„ÙƒÙ„" || p.cat === filter).map(p => `
            <div class="product">
                ${p.status !== 'a' ? '<div class="out-of-stock">Ù†Ø§ÙØ° Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†</div>' : ''}
                <img src="${p.img}">
                <div style="font-weight:bold; margin-top:8px; height:40px; overflow:hidden;">${p.title}</div>
                <div style="color:var(--danger); font-weight:bold;">${p.price.toLocaleString()} Ø¯.Ø¹</div>
                <button class="btn btn-p" style="margin-top:10px; padding:8px;" onclick="openOptions(${p.id})">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
            </div>`).join('');
    }

    function openOptions(id) {
        curP = productsList.find(x => x.id === id);
        if(curP.status !== 'a') return alert("Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠØ§Ù‹");
        document.getElementById('opt-modal').style.display = 'flex';
        document.getElementById('opt-title').innerText = curP.title;
        document.getElementById('opt-color').innerHTML = curP.colors.split(',').map(c => `<option>${c.trim()}</option>`).join('');
        const s = document.getElementById('size-div');
        if(curP.sizes) {
            s.style.display = 'block';
            document.getElementById('opt-size').innerHTML = curP.sizes.split(',').map(sz => `<option>${sz.trim()}</option>`).join('');
        } else { s.style.display = 'none'; }
    }

    function confirmAdd() {
        cart.push({ ...curP, choiceColor: document.getElementById('opt-color').value, choiceSize: document.getElementById('opt-size').value || '---', qty: 1, cid: Date.now() });
        updateCartUI();
        closeModals();
    }

    function updateCartUI() {
        document.getElementById('cart-count').innerText = cart.length;
    }

    function openCart() {
        if(cart.length === 0) return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
        document.getElementById('cart-modal').style.display = 'flex';
        renderCartList();
    }

    function renderCartList() {
        const list = document.getElementById('cart-list');
        list.innerHTML = cart.map(i => `
            <div style="display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid #eee;">
                <div><b>${i.title}</b><br><small>${i.choiceColor} | ${i.choiceSize}</small></div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <button class="qty-btn" onclick="changeQty(${i.cid}, -1)">-</button>
                    <b>${i.qty}</b>
                    <button class="qty-btn" onclick="changeQty(${i.cid}, 1)">+</button>
                    <span style="color:red; cursor:pointer; margin-right:10px;" onclick="removeItem(${i.cid})">ğŸ—‘ï¸</span>
                </div>
            </div>`).join('');
        const total = cart.reduce((s, i) => s + (i.price * i.qty), 0);
        document.getElementById('total-val').innerText = (total + 5000).toLocaleString() + " Ø¯.Ø¹";
    }

    function changeQty(cid, val) {
        const item = cart.find(x => x.cid === cid);
        item.qty += val;
        if(item.qty < 1) return removeItem(cid);
        renderCartList();
    }

    function removeItem(cid) {
        cart = cart.filter(x => x.cid !== cid);
        if(cart.length === 0) closeModals(); else renderCartList();
        updateCartUI();
    }

    function openCheckout() {
        document.getElementById('cart-modal').style.display = 'none';
        document.getElementById('checkout-modal').style.display = 'flex';
    }

    function submitOrder() {
        const name = document.getElementById('f-fullname').value;
        const phone = document.getElementById('f-phone').value;
        const city = document.getElementById('f-city').value;
        const point = document.getElementById('f-point').value;
        
        if(!name || phone.length !== 11 || !city || !point) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù„Ø¦ ÙƒØ§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)");

        const btn = document.getElementById('final-btn');
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©..."; btn.disabled = true;

        let itemsText = cart.map(i => `- ${i.title} (Ø§Ù„Ø¹Ø¯Ø¯: ${i.qty}) [${i.choiceColor}/${i.choiceSize}]`).join('\n');
        let total = cart.reduce((s, i) => s + (i.price * i.qty), 0) + 5000;

        const params = {
            from_name: name,
            email: db.user.email,
            phone: phone,
            address: `${city} - ${point}`,
            message: `Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª:\n${itemsText}\n\nØ§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total.toLocaleString()} Ø¯.Ø¹\nÙ…Ù„Ø§Ø­Ø¸Ø§Øª: ${document.getElementById('f-notes').value}`,
            title: "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±"
        };

        emailjs.send("service_ga7ytjo", "template_lgvpsns", params)
        .then(() => {
            alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªØµÙ„ Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
            db.orders.push({ id: Date.now(), total: total, time: Date.now(), status: "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©" });
            localStorage.setItem('elite_o', JSON.stringify(db.orders));
            cart = []; updateCartUI(); location.reload();
        }, () => {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„"); btn.disabled = false; btn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨";
        });
    }

    function showPage(p) {
        document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
        document.getElementById(p + '-page').style.display = 'block';
        if(p === 'orders') renderOrders();
        if(p === 'admin') renderAdmin();
    }

    function renderOrders() {
        const list = document.getElementById('orders-list');
        list.innerHTML = db.orders.reverse().map(o => {
            const canCancel = (Date.now() - o.time) < (2 * 60 * 60 * 1000);
            return `
                <div style="background:white; padding:15px; border-radius:15px; margin-bottom:10px; border-right:5px solid var(--dark);">
                    <b>Ø·Ù„Ø¨ Ø±Ù‚Ù… #${o.id.toString().slice(-4)}</b><br>
                    Ø§Ù„Ù…Ø¨Ù„Øº: ${o.total.toLocaleString()} Ø¯.Ø¹ | Ø§Ù„Ø­Ø§Ù„Ø©: ${o.status}<br>
                    ${canCancel ? `<button style="color:red; border:none; background:none; cursor:pointer;" onclick="cancelOrder(${o.id})">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ ğŸ—‘ï¸</button>` : ''}
                </div>`;
        }).join('') || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø©";
    }

    function cancelOrder(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø·Ù„Ø¨ØŸ")) {
            db.orders = db.orders.filter(o => o.id !== id);
            localStorage.setItem('elite_o', JSON.stringify(db.orders));
            renderOrders();
        }
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ§Ø¬Ø±
    function renderAdmin() {
        const list = document.getElementById('admin-inventory');
        list.innerHTML = productsList.map(p => `
            <div style="display:flex; justify-content:space-between; background:white; padding:10px; margin-bottom:5px; border-radius:10px;">
                <span>${p.title}</span>
                <div>
                    <button onclick="toggleStock(${p.id})" style="color:${p.status=='a'?'green':'red'}">${p.status=='a'?'Ù…ØªÙˆÙØ±':'Ù†Ø§ÙØ°'}</button>
                    <button onclick="deleteP(${p.id})" style="color:red; border:none; background:none; margin-right:10px;">ğŸ—‘ï¸</button>
                </div>
            </div>`).join('');
    }

    function toggleStock(id) {
        const p = productsList.find(x => x.id === id);
        p.status = p.status === 'a' ? 'o' : 'a';
        saveProds(); renderAdmin(); renderProducts();
    }

    function deleteP(id) {
        if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            productsList = productsList.filter(x => x.id !== id);
            saveProds(); renderAdmin(); renderProducts();
        }
    }

    function saveNewProduct() {
        const n = document.getElementById('adm-name').value;
        const p = document.getElementById('adm-price').value;
        if(!n || !p) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        productsList.unshift({
            id: Date.now(), title: n, price: parseInt(p), 
            cat: document.getElementById('adm-cat').value,
            img: document.getElementById('adm-img').value || 'https://via.placeholder.com/400',
            colors: document.getElementById('adm-colors').value || 'Ø£Ø³Ø§Ø³ÙŠ',
            sizes: document.getElementById('adm-sizes').value || '',
            status: 'a'
        });
        saveProds(); renderAdmin(); renderProducts();
    }

    function saveProds() { localStorage.setItem('elite_p', JSON.stringify(productsList)); }
    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
    
    window.onload = startApp;
</script>
</body>
</html>
